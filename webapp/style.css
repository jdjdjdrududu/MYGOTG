/*
 * Глобальные переменные и основные стили
 * Используются для определения цветовой палитры, типографики,
 * радиусов скругления и теней, а также статусов.
 */
:root {
    /* Цвета Telegram Theme */
    --tg-bg-color: var(--tg-theme-bg-color, #f7f8fa);
    --tg-text-color: var(--tg-theme-text-color, #000000);
    --tg-hint-color: var(--tg-theme-hint-color, #707579);
    --tg-link-color: var(--tg-theme-link-color, #007aff);
    --tg-button-color: var(--tg-theme-button-color, #007aff);
    --tg-button-text-color: var(--tg-theme-button-text-color, #ffffff);
    --tg-secondary-bg-color: var(--tg-theme-secondary-bg-color, #ffffff);

    /* Типографика */
    --font-family: -apple-system, BlinkMacMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;

    /* Скругления */
    --radius-s: 8px; /* Немного увеличено */
    --radius-m: 14px; /* Увеличено для более гладкого вида */
    --radius-l: 22px; /* Увеличено для более современного вида */

    /* Тени */
    --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08); /* Чуть заметнее, но мягче */
    --shadow-strong: 0 8px 30px rgba(0, 0, 0, 0.18); /* Усилено для акцента */

    /* Цвета статусов */
    --status-new: #007aff; /* Синий */
    --status-progress: #ff9500; /* Оранжевый */
    --status-completed: #34c759; /* Зеленый */
    --status-canceled: #ff3b30; /* Красный */
    --status-awaiting: #ffcc00; /* Желтый */
    --status-calculated: #5856d6; /* Фиолетовый */

    /* Цвета кнопок действия */
    --button-danger-color: #ff3b30;
    --button-success-color: #34c759;

    /* Новые переменные для форм (уточненные) */
    --form-field-bg: var(--tg-secondary-bg-color);
    --form-field-border-color: #e6e6e6; /* Легче для чистого вида */
    --form-field-focus-border: var(--tg-link-color);
    --form-field-placeholder-color: var(--tg-hint-color);
    --form-group-gap: 20px; /* Увеличим отступ между группами полей */
    --fieldset-border-color: #e0e0e0; /* Легкий серый для разделителя fieldset */

    /* Улучшенные переменные для анимаций */
    --transition-duration-fast: 0.2s;
    --transition-duration-normal: 0.6s;
    --transition-duration-slow: 0.8s;
    --transition-duration-ultra-smooth: 1.0s;
    
    /* Продвинутые easing функции для максимальной плавности */
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-out-circ: cubic-bezier(0.08, 0.82, 0.17, 1);
    --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
    --ease-in-out-back: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --ease-smooth: cubic-bezier(0.4, 0.0, 0.2, 1);
    --ease-ultra-smooth: cubic-bezier(0.25, 0.1, 0.25, 1);
    --ease-elegant: cubic-bezier(0.215, 0.61, 0.355, 1);
    --ease-anticipate: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    
    /* Новые переменные для blur и opacity эффектов */
    --blur-light: blur(4px);
    --blur-medium: blur(8px);
    --blur-heavy: blur(12px);
    --backdrop-opacity: 0.95;
    
    /* Переменные для глубины */
    --shadow-depth-1: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    --shadow-depth-2: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
    --shadow-depth-3: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
    --shadow-depth-4: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
}

/* === НОВЫЙ СТИЛЬ: для отключенных кнопок === */
.button-disabled,
button:disabled {
    cursor: not-allowed !important;
    opacity: 0.65 !important;
    pointer-events: none; /* Предотвращаем любые события */
}
/* === КОНЕЦ НОВОГО СТИЛЯ === */

.button-primary {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    box-shadow: var(--shadow-depth-1);
    overflow: hidden;
    
    /* Убираем стандартные эффекты нажатия на мобильных */
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    
    /* Добавляем поддержку для псевдоэлементов */
    z-index: 1;
    background-color: var(--tg-button-color);
    color: var(--tg-button-text-color);
}

.button-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-3);
    filter: brightness(1.05);
}

.button-primary:active {
    transform: translateY(-1px) scale(0.98);
    transition-duration: 0.1s;
}

.button-primary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-fast) var(--ease-out-circ);
    pointer-events: none;
    z-index: -1;
}

.button-primary:active::before {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: all 0.6s var(--ease-out-circ);
}

/* === НОВЫЙ БЛОК ДЛЯ button-success (добавлен для кнопки "Позвонить") === */
.button-success {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    box-shadow: var(--shadow-depth-1);
    overflow: hidden;
    
    /* Убираем стандартные эффекты нажатия на мобильных */
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    
    /* Добавляем поддержку для псевдоэлементов */
    z-index: 1;
    background-color: var(--button-success-color);
    color: var(--tg-button-text-color);
}

.button-success:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-3);
    filter: brightness(1.05);
}

.button-success:active {
    transform: translateY(-1px) scale(0.98);
    transition-duration: 0.1s;
}

.button-success::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-fast) var(--ease-out-circ);
    pointer-events: none;
    z-index: -1;
}

.button-success:active::before {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: all 0.6s var(--ease-out-circ);
}
/* === КОНЕЦ: ВСТАВЬТЕ ЭТОТ БЛОК === */


/*
 * Основные стили для `body`
 */
body {
    font-family: var(--font-family);
    background-color: var(--tg-bg-color);
    color: var(--tg-text-color);
    margin: 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    padding-bottom: 100px; /* Место для нижней панели + FAB */
}

/*
 * Контейнер приложения и управление панелями
 */
#app-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* Базовая настройка панелей для ультра-плавных анимаций */
.panel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--tg-bg-color);
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 120px; /* Увеличиваем нижний отступ */
    box-sizing: border-box;
    transform: translateX(100%);
    display: none;
    will-change: transform, opacity, filter;
    flex-direction: column;
    
    /* Максимальное аппаратное ускорение */
    backface-visibility: hidden;
    perspective: 1000px;
    transform-style: preserve-3d;
    
    /* Оптимизация для композитного слоя */
    isolation: isolate;
    contain: layout style paint;
    
    /* Предотвращение layout shift */
    min-height: 100vh;
    
    /* Плавный скроллинг */
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Переопределение padding для панелей, управляющих им внутренне */
#orders-panel,
#user-panel,
#clients-panel,
#client-detail-panel,
#staff-hub-panel,
#staff-list-panel,
#order-detail-panel,
#user-order-creation-panel,
#order-creation-panel,
#contact-operator-panel {
    padding-left: 0;
    padding-right: 0;
    padding-top: 0;
    /* Это изменение оставляет padding-bottom: 90px из класса .panel, решая проблему */
}

/*
 * ШАГ 2: Стили для цветных кнопок (оставляем их, так как они полезны)
 */

/* Кнопка для опасных действий (красная) */
.button-danger {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    box-shadow: var(--shadow-depth-1);
    overflow: hidden;
    
    /* Убираем стандартные эффекты нажатия на мобильных */
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    
    /* Добавляем поддержку для псевдоэлементов */
    z-index: 1;
    background-color: var(--button-danger-color);
    color: var(--tg-button-text-color);
}

.button-danger:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-3);
    filter: brightness(1.05);
}

.button-danger:active {
    transform: translateY(-1px) scale(0.98);
    transition-duration: 0.1s;
}

.button-danger::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-fast) var(--ease-out-circ);
    pointer-events: none;
    z-index: -1;
}

.button-danger:active::before {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: all 0.6s var(--ease-out-circ);
}

/* Кнопка для действий, требующих внимания (оранжевая) */
.button-warning {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    box-shadow: var(--shadow-depth-1);
    overflow: hidden;
    
    /* Убираем стандартные эффекты нажатия на мобильных */
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    
    /* Добавляем поддержку для псевдоэлементов */
    z-index: 1;
    background-color: var(--status-progress);
    color: var(--tg-button-text-color);
}

.button-warning:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-3);
    filter: brightness(1.05);
}

.button-warning:active {
    transform: translateY(-1px) scale(0.98);
    transition-duration: 0.1s;
}

.button-warning::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-fast) var(--ease-out-circ);
    pointer-events: none;
    z-index: -1;
}

.button-warning:active::before {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: all 0.6s var(--ease-out-circ);
}

.panel.visible {
    transform: translateX(0);
    display: flex;
}

.panel.no-transition {
    transition: none !important;
}

/*
 * Анимации переходов панелей - УЛУЧШЕННЫЕ ПЛАВНЫЕ ПЕРЕХОДЫ
 */

/* НОВЫЕ УЛЬТРА-ПЛАВНЫЕ KEYFRAMES С BLUR ЭФФЕКТАМИ */
@keyframes slide-in-from-right-ultra-smooth {
    0% { 
        transform: translateX(100%) scale(0.92) rotateY(5deg);
        opacity: 0;
        filter: var(--blur-medium);
        backdrop-filter: var(--blur-light);
    }
    50% {
        transform: translateX(50%) scale(0.96) rotateY(2deg);
        opacity: 0.6;
        filter: var(--blur-light);
    }
    100% { 
        transform: translateX(0) scale(1) rotateY(0deg);
        opacity: 1;
        filter: none;
        backdrop-filter: none;
    }
}

@keyframes slide-out-to-left-ultra-smooth {
    0% { 
        transform: translateX(0) scale(1) rotateY(0deg);
        opacity: 1;
        filter: none;
        z-index: 10;
    }
    50% {
        transform: translateX(-25%) scale(0.96) rotateY(-2deg);
        opacity: 0.7;
        filter: var(--blur-light);
    }
    100% { 
        transform: translateX(-50%) scale(0.88) rotateY(-8deg);
        opacity: 0.2;
        filter: var(--blur-medium);
        z-index: 1;
    }
}

@keyframes slide-in-from-left-ultra-smooth {
    0% { 
        transform: translateX(-100%) scale(0.92) rotateY(-5deg);
        opacity: 0;
        filter: var(--blur-medium);
        backdrop-filter: var(--blur-light);
    }
    50% {
        transform: translateX(-50%) scale(0.96) rotateY(-2deg);
        opacity: 0.6;
        filter: var(--blur-light);
    }
    100% { 
        transform: translateX(0) scale(1) rotateY(0deg);
        opacity: 1;
        filter: none;
        backdrop-filter: none;
    }
}

@keyframes slide-out-to-right-ultra-smooth {
    0% { 
        transform: translateX(0) scale(1) rotateY(0deg);
        opacity: 1;
        filter: none;
        z-index: 10;
    }
    50% {
        transform: translateX(25%) scale(0.96) rotateY(2deg);
        opacity: 0.7;
        filter: var(--blur-light);
    }
    100% { 
        transform: translateX(100%) scale(0.88) rotateY(8deg);
        opacity: 0;
        filter: var(--blur-medium);
        z-index: 1;
    }
}

/* Параллакс эффект для фонового содержимого - улучшенный */
@keyframes parallax-slide-left-smooth {
    0% { transform: translateX(0) scale(1); opacity: 1; }
    100% { transform: translateX(-15%) scale(0.95); opacity: 0.8; }
}

@keyframes parallax-slide-right-smooth {
    0% { transform: translateX(0) scale(1); opacity: 1; }
    100% { transform: translateX(15%) scale(0.95); opacity: 0.8; }
}

/* Новая анимация для плавного появления контента */
@keyframes content-fade-in {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.98);
        filter: var(--blur-light);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: none;
    }
}

/* ПРИМЕНЕНИЕ УЛУЧШЕННЫХ АНИМАЦИЙ */
.slide-in-right { 
    animation: slide-in-from-right-ultra-smooth var(--transition-duration-slow) var(--ease-elegant) forwards;
    will-change: transform, opacity, filter;
}

.slide-out-to-left { 
    animation: slide-out-to-left-ultra-smooth var(--transition-duration-slow) var(--ease-elegant) forwards;
    will-change: transform, opacity, filter;
}

.slide-in-left { 
    animation: slide-in-from-left-ultra-smooth var(--transition-duration-slow) var(--ease-elegant) forwards;
    will-change: transform, opacity, filter;
}

.slide-out-to-right { 
    animation: slide-out-to-right-ultra-smooth var(--transition-duration-slow) var(--ease-elegant) forwards;
    will-change: transform, opacity, filter;
}

/* Добавляем класс для плавного появления контента */
.content-fade-in {
    animation: content-fade-in var(--transition-duration-normal) var(--ease-ultra-smooth) forwards;
    animation-delay: 0.3s;
    opacity: 0;
}

/* Добавляем staggered анимацию для элементов списка */
.stagger-animation > * {
    animation: content-fade-in var(--transition-duration-normal) var(--ease-ultra-smooth) forwards;
    opacity: 0;
}

.stagger-animation > *:nth-child(1) { animation-delay: 0.1s; }
.stagger-animation > *:nth-child(2) { animation-delay: 0.2s; }
.stagger-animation > *:nth-child(3) { animation-delay: 0.3s; }
.stagger-animation > *:nth-child(4) { animation-delay: 0.4s; }
.stagger-animation > *:nth-child(5) { animation-delay: 0.5s; }
.stagger-animation > *:nth-child(6) { animation-delay: 0.6s; }
.stagger-animation > *:nth-child(7) { animation-delay: 0.7s; }
.stagger-animation > *:nth-child(8) { animation-delay: 0.8s; }
.stagger-animation > *:nth-child(9) { animation-delay: 0.9s; }
.stagger-animation > *:nth-child(10) { animation-delay: 1.0s; }

/* Добавляем параллакс эффект для панелей, которые остаются позади */
.panel.parallax-left {
    animation: parallax-slide-left var(--transition-duration-normal) var(--ease-out-expo) forwards;
}

.panel.parallax-right {
    animation: parallax-slide-right var(--transition-duration-normal) var(--ease-out-expo) forwards;
}

/* Утилитарный класс для скрытия элементов */
.hidden { display: none !important; }

/*
 * Стили заголовков панелей
 */
.panel-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    background-color: var(--tg-bg-color);
    padding: 15px;
    box-shadow: var(--shadow-soft);
    position: sticky;
    top: 0;
    z-index: 10;
    flex-shrink: 0;
    width: 100%; /* Убедитесь, что занимает всю ширину */
    box-sizing: border-box; /* Включает padding в ширину */
    min-height: 60px;
}

.panel-header h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    flex-grow: 0;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.back-button {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--tg-hint-color);
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.back-button:hover {
    background-color: rgba(0, 122, 255, 0.1);
    color: var(--tg-link-color);
    transform: translateY(-50%) scale(1.1);
}

.back-button:active {
    transform: translateY(-50%) scale(0.95);
    background-color: rgba(0, 122, 255, 0.2);
}

/*
 * Стили для фильтров и поиска
 */
.filters-container {
    overflow-x: auto;
    white-space: nowrap;
    padding: 5px 0;
    -ms-overflow-style: none;
    scrollbar-width: none;
    min-height: 80px;
    display: flex;
    align-items: center;
}
.filters-container::-webkit-scrollbar { display: none; }

.status-filter-btn {
    display: inline-block;
    padding: 8px 16px;
    margin-right: 8px;
    border: 1px solid var(--tg-hint-color);
    background-color: transparent;
    color: var(--tg-link-color);
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
}
.status-filter-btn.active {
    background-color: var(--tg-button-color);
    color: var(--tg-button-text-color);
    border-color: var(--tg-button-color);
}

.search-container {
    padding: 0 15px; /* Единые отступы */
    margin-bottom: 16px;
    width: 100%;
    box-sizing: border-box;
}
.search-input-wrapper {
    position: relative;
    margin-bottom: 20px;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}
.lottie-search-icon {
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    pointer-events: none;
}
.search-container input {
    width: 100%;
    padding: 12px 16px 12px 56px;
    border: 1px solid transparent;
    border-radius: var(--radius-l);
    background-color: var(--tg-secondary-bg-color);
    color: var(--tg-text-color);
    box-sizing: border-box;
    font-size: 16px;
    box-shadow: var(--shadow-soft);
}
.search-container input:focus {
    outline: none;
    border-color: var(--tg-link-color);
}

.search-input-wrapper:focus-within {
    transform: translateY(-2px);
}

input[type="search"],
input[type="text"],
input[type="tel"],
input[type="email"] {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    border: 2px solid transparent;
}

input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="email"]:focus {
    border-color: var(--tg-link-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    transform: scale(1.02);
}

/*
 * Стили для списка контента и карточек
 */
.content-list {
    list-style-type: none;
    padding: 0 15px; /* Единые отступы для списков */
    margin: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
    box-sizing: border-box;
    min-height: 200px; /* Предотвращает collapse при пустом списке */
    transition: min-height var(--transition-duration-normal) var(--ease-smooth);
}

.card {
    width: 100%;
    box-sizing: border-box;

    background-color: var(--tg-secondary-bg-color);
    border-radius: var(--radius-l);
    padding: 16px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-shadow: var(--shadow-soft);
    border: 1px solid #E9EDF5;
    min-height: 100px;
    contain: layout style; /* CSS containment для лучшей производительности */
}
.card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-strong);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}
.order-id {
    font-weight: 600;
    font-size: 1.1em;
}
.order-status-badge {
    font-size: 0.8em;
    padding: 4px 10px;
    border-radius: 12px;
    color: #fff;
    font-weight: 600;
    text-transform: capitalize;
}
/* Цвета бейджей статусов */
.order-status-badge[data-status="new"],
.order-status-badge[data-status="awaiting_cost"] { background-color: var(--status-new); }
.order-status-badge[data-status="in_progress"] { background-color: var(--status-progress); }
.order-status-badge[data-status="awaiting_confirmation"],
.order-status-badge[data-status="awaiting_payment"] { background-color: var(--status-awaiting); color: #000; }
.order-status-badge[data-status="completed"],
.order-status-badge[data-status="settled"] { background-color: var(--status-completed); }
.order-status-badge[data-status="calculated"] { background-color: var(--status-calculated); }
.order-status-badge[data-status="canceled"] { background-color: var(--status-canceled); }

.card-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95em;
    color: var(--tg-text-color);
}
.info-item i {
    color: var(--tg-hint-color);
    width: 16px;
    text-align: center;
}
.card-footer {
    display: flex;
    justify-content: space-between;
    margin-top: 12px;
    font-size: 0.9em;
    color: var(--tg-hint-color);
}
.client-name, .executor-name { font-weight: 600; }
.client-info, .executor-role, .executor-status { color: var(--tg-hint-color); font-size: 0.9em; }

/*
 * Стили для форм (НОВАЯ, ИСПРАВЛЕННАЯ ВЕРСИЯ)
 */
.form-content-wrapper {
    flex-grow: 1;
    overflow-y: auto;
    padding: 16px 15px 0 15px; /* Добавлен отступ сверху */
    display: flex;
    flex-direction: column;
}

form {
    display: flex;
    flex-direction: column;
    gap: 16px; /* Отступ между fieldset */
    padding-bottom: 120px; /* Отступ снизу, чтобы кнопка не перекрывала последнее поле */
}

fieldset {
    border: none;
    border-radius: var(--radius-m);
    padding: 20px 16px 16px;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--form-group-gap);
    background-color: var(--form-field-bg);
    box-shadow: var(--shadow-soft);
    position: relative;
    min-width: 0; /* <<<===== ГЛАВНЫЙ ФИКС ЗДЕСЬ */
}

legend {
    /* Полностью переработанная легенда */
    font-size: 1.2em; /* Четкий, видимый размер */
    font-weight: 700;
    color: var(--tg-text-color); /* Основной цвет текста */
    margin-bottom: 16px; /* Отступ после заголовка */
    padding: 0;
    width: 100%;
    /* Убираем все старые хаки с позиционированием */
}

.form-group {
    display: flex;
    flex-direction: column;
    position: relative;
}

/* Статичная метка, для которой не нужна анимация */
.form-group .static-label {
    font-size: 0.9em;
    color: var(--tg-hint-color);
    margin-bottom: 8px;
    font-weight: 500;
}

.form-group label:not(.static-label) {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1em; /* Увеличен базовый размер шрифта метки */
    color: var(--tg-hint-color);
    pointer-events: none;
    transition: all 0.2s ease-out;
    background-color: var(--form-field-bg);
    padding: 0 4px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 18px 16px 10px 16px; /* Скорректирован padding для метки */
    border: 1px solid var(--form-field-border-color);
    border-radius: var(--radius-s);
    background-color: var(--form-field-bg);
    color: var(--tg-text-color);
    box-sizing: border-box;
    font-size: 16px;
    font-family: var(--font-family);
    transition: all 0.2s ease;
    -webkit-appearance: none; /* Убираем стандартный вид для iOS */
}

/* Эффект плавающей метки: поднятие и изменение стиля */
.form-group input:focus + label:not(.static-label),
.form-group textarea:focus + label:not(.static-label),
.form-group select:focus + label:not(.static-label),
.form-group input:not(:placeholder-shown) + label:not(.static-label),
.form-group textarea:not(:placeholder-shown) + label:not(.static-label),
.form-group select:valid + label:not(.static-label) { /* Исправлено для select */
    top: 0; /* Позиция вверху */
    font-size: 0.8em; /* Размер вверху */
    color: var(--tg-link-color);
    transform: translateY(-50%);
}

/* Специальные стили для date/time инпутов, у которых нет :placeholder-shown */
.form-group input[type="date"] + label,
.form-group input[type="time"] + label {
    top: 0;
    font-size: 0.8em;
    transform: translateY(-50%);
    color: var(--tg-link-color);
}

.form-group select:invalid {
    color: var(--tg-hint-color);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: transparent; /* Скрываем стандартный placeholder */
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--form-field-focus-border);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15); /* Мягкий фокус-эффект */
}

/* НОВЫЙ СТИЛЬ: Скрываем пустой option-плейсхолдер из выпадающего списка */
select:required option[value=""] {
    display: none;
}

.form-group-inline {
    display: flex;
    gap: var(--form-group-gap);
}
.form-group-inline > .form-group {
    flex: 1;
}

/*
 * ===================================================================
 * ИСПРАВЛЕННЫЕ И ОБЪЕДИНЕННЫЕ СТИЛИ ДЛЯ КАРУСЕЛИ МЕДИАФАЙЛОВ
 * ===================================================================
 */

/* Главный контейнер для карусели превью ("окно" просмотра) */
.media-preview-swiper {
    position: relative;
    width: 100%;
    min-width: 0;
    border-radius: var(--radius-m);
    margin-bottom: 12px;
    box-sizing: border-box;
    border: 2px dashed var(--form-field-border-color);
    transition: border-color 0.3s ease;
    overflow: hidden;
    background-color: rgba(0,0,0,0.02);
}

/* Меняем границу, когда в карусели появляются файлы */
.media-preview-swiper.swiper-initialized {
    border-style: solid;
}

/* Обертка для слайдов, которую создает Swiper (прокручиваемая область) */
.media-preview-swiper .swiper-wrapper {
    height: 120px; /* Задаем высоту здесь, а не на родительском контейнере */
    align-items: center; /* Выравниваем слайды по центру по вертикали */
    padding: 0 10px; /* Добавляем горизонтальный отступ по краям карусели */
    box-sizing: border-box;
}

/* Стилизация каждого слайда-превью */
.media-preview-swiper .swiper-slide {
    width: 100px !important; /* Фиксированная ширина */
    height: 100px; /* Фиксированная высота */
    flex-shrink: 0; /* Запрещаем сжиматься внутри flex-контейнера */
    border-radius: var(--radius-s);
    overflow: hidden;
    background-color: var(--tg-bg-color);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Контейнер для изображения/видео внутри слайда */
.media-preview-swiper .media-item {
    width: 100%;
    height: 100%;
}

/* Изображение или видео внутри превью */
.media-preview-swiper .media-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Изображение/видео полностью заполняет контейнер, обрезая лишнее */
    display: block; /* Убираем лишние пробелы под img/video */
    background-color: var(--tg-bg-color); /* Placeholder цвет */
}

/* Кнопка удаления медиа поверх превью */
.delete-media-button {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    border: none;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
    line-height: 1;
    z-index: 10;
}
.delete-media-button:hover {
    background-color: rgba(255, 59, 48, 0.8); /* Красный при наведении */
    transform: scale(1.1);
}

/* Пагинация (точки) для Swiper */
.media-preview-swiper .swiper-pagination {
    bottom: 5px !important; /* Позиционируем относительно низа .swiper-wrapper */
}

.media-preview-swiper .swiper-pagination-bullet {
    background-color: var(--tg-hint-color);
    opacity: 0.4;
    transition: all 0.3s ease;
    width: 6px;
    height: 6px;
}

.media-preview-swiper .swiper-pagination-bullet-active {
    background-color: var(--tg-link-color);
    opacity: 1;
    transform: scale(1.2);
}

/* Скрываем стрелки навигации, если они есть по умолчанию */
.swiper-button-next, .swiper-button-prev {
    display: none !important;
}

/*
 * ===================================================================
 * КОНЕЦ ИСПРАВЛЕННЫХ СТИЛЕЙ ДЛЯ КАРУСЕЛИ
 * ===================================================================
 */

.form-actions {
    /* Делаем блок с кнопкой "липким" */
    position: sticky;
    bottom: 0;
    background: linear-gradient(to top, var(--tg-bg-color) 85%, transparent); /* Градиент для плавного перехода */
    padding: 20px 0; /* Отступы сверху и снизу */
    width: 100%;
    z-index: 20;
    margin-top: auto; /* Прижимает блок к низу flex-контейнера */
}

.form-actions .button-primary {
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    display: block;
    box-shadow: var(--shadow-strong); /* Добавляем тень для лучшей видимости */
}


/*
 * Стили для деталей (клиентов, заказов)
 */
#client-details-content {
    padding: 25px; /* Увеличено для большего внутреннего отступа */
}
#order-details-content {
    background-color: var(--tg-secondary-bg-color);
    padding: 20px;
    border-radius: var(--radius-l);
    margin: 15px;
    box-shadow: var(--shadow-soft);
    box-sizing: border-box;
    width: calc(100% - 30px);
}
.client-details-grid dl, .details-grid dl {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 18px 15px; /* Увеличено для вертикального отступа */
    margin: 0;
    padding: 0;
}
.client-details-grid dt, .details-grid dt {
    font-weight: 500;
    color: var(--tg-hint-color);
    white-space: nowrap; /* Предотвращаем перенос заголовков */
}
.client-details-grid dd, .details-grid dd {
    margin: 0;
    font-size: 16px;
    word-break: break-word; /* Изменено на break-word для лучшего переноса */
    text-align: right; /* Выравнивание по правому краю для аккуратности */
}
.details-grid dd.editable {
    color: var(--tg-link-color);
    cursor: pointer;
    text-decoration: none;
    border-bottom: 1px dashed var(--tg-link-color);
}
.client-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 0; /* Убираем лишний отступ */
    margin-top: 20px;
    padding: 0 15px 15px 15px; /* Единые отступы */
}
.client-actions .button-primary {
    flex: 1;
    text-align: center;
}

#client-detail-panel h3, #order-detail-panel h3 {
    margin-top: 25px;
    margin-bottom: 15px;
    font-size: 1.1em;
    font-weight: 600;
    padding: 0 15px; /* Единые отступы */
}
/* Контейнер-обертка для создания рамки, как при создании заказа */
.media-gallery-container {
    margin: 0 15px; /* Боковые отступы, чтобы соответствовать остальному контенту */
    padding: 12px;  /* Внутренний отступ для "воздуха" вокруг фото */
    border: 2px dashed var(--form-field-border-color); /* Такая же рамка, как при создании заказа */
    border-radius: var(--radius-m);
    background-color: rgba(0, 0, 0, 0.02);
    box-sizing: border-box;
}

/* Измененные стили для самой галереи, которая теперь находится внутри обертки */
#order-detail-media-gallery {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding: 0; /* Весь padding теперь на .media-gallery-container */
    -webkit-overflow-scrolling: touch; /* Плавный скролл на iOS */
    -ms-overflow-style: none;  /* Скрыть скроллбар для IE и Edge */
    scrollbar-width: none;  /* Скрыть скроллбар для Firefox */
}

#order-detail-media-gallery::-webkit-scrollbar {
    display: none; /* Скрыть скроллбар для WebKit */
}

.media-item {
    flex-shrink: 0;
    width: 120px;
    height: 120px;
    position: relative;
    border-radius: var(--radius-m);
    overflow: hidden;
    background-color: var(--tg-bg-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.media-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.media-type-icon {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: rgba(0,0,0,0.5);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}
#add-media-btn {
    width: calc(100% - 30px);
    margin: 20px 15px 30px 15px;
    padding: 16px 28px;
    box-sizing: border-box;
}
.executor-card .card-body {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
}

/*
 * Нижняя навигационная панель (Bottom Ribbon) - УЛУЧШЕННАЯ
 */
.bottom-ribbon {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(135deg, var(--tg-secondary-bg-color) 0%, var(--tg-bg-color) 100%);
    border-top: 1px solid rgba(0, 0, 0, 0.08);
    display: flex;
    justify-content: space-around;
    padding: 8px 5px;
    box-sizing: border-box;
    box-shadow: var(--shadow-depth-3);
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    
    /* Добавляем анимацию появления */
    transform: translateY(100%);
    animation: slideUpFromBottom var(--transition-duration-normal) var(--ease-out-expo) forwards;
}

/* Анимация появления нижней навигации */
@keyframes slideUpFromBottom {
    0% {
        transform: translateY(100%);
        opacity: 0;
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

.ribbon-button {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    max-width: 120px;
    padding: 12px 8px;
    font-size: 11px;
    font-weight: 500;
    background-color: transparent;
    color: var(--tg-hint-color);
    border: none;
    cursor: pointer;
    border-radius: var(--radius-m);
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    text-align: center;
    gap: 6px;
    overflow: hidden;
    
    /* Добавляем поддержку для ripple эффекта */
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

/* Ripple эффект для кнопок навигации */
.ribbon-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, var(--tg-link-color) 0%, transparent 70%);
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-fast) var(--ease-out-circ);
    pointer-events: none;
    z-index: -1;
}

.ribbon-button:active::before {
    width: 120px;
    height: 120px;
    opacity: 0.2;
}

/* Улучшенные состояния кнопок */
.ribbon-button:hover {
    background-color: rgba(0, 122, 255, 0.08);
    color: var(--tg-link-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-1);
}

.ribbon-button.active {
    background: linear-gradient(135deg, var(--tg-link-color) 0%, rgba(0, 122, 255, 0.8) 100%);
    color: white;
    transform: translateY(-3px) scale(1.05);
    box-shadow: var(--shadow-depth-2);
    
    /* Добавляем внутреннее свечение */
    box-shadow: 
        var(--shadow-depth-2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        0 0 20px rgba(0, 122, 255, 0.3);
}

.ribbon-button:active {
    transform: translateY(-1px) scale(0.98);
    transition-duration: 0.1s;
}

.ribbon-button i {
    font-size: 20px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.ribbon-button.active i {
    transform: scale(1.1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

/* Анимация для переключения активного состояния */
.ribbon-button span {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    opacity: 0.9;
}

.ribbon-button.active span {
    opacity: 1;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Индикатор активного состояния */
.ribbon-button::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, white, transparent);
    border-radius: 2px;
    transform: translateX(-50%);
    transition: width var(--transition-duration-normal) var(--ease-out-expo);
}

.ribbon-button.active::after {
    width: 60%;
}

/* Улучшенный фокус для доступности */
.ribbon-button:focus-visible {
    outline: 2px solid var(--tg-link-color);
    outline-offset: 2px;
    background-color: rgba(0, 122, 255, 0.1);
}

/*
 * Стили для сообщений об ошибках
 */
#error-message {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: rgba(255, 59, 48, 0.9);
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: 500;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

#error-message i {
    font-size: 18px;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeOutUp {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-20px);
    }
}

/*
 * Стили для загрузчиков (Spinners)
 */
#top-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px; /* Высота полосы */
    background-color: transparent; /* Фон-контейнер прозрачный */
    z-index: 9999; /* Высший z-index, чтобы быть поверх всего */
    overflow: hidden;
    pointer-events: none; /* Не мешает кликам */
    transform: translateZ(0); /* Аппаратное ускорение */
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--tg-link-color) 50%, 
        transparent 100%);
    animation: progressSlide 1.5s ease-in-out infinite;
}

@keyframes progressSlide {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* УЛУЧШЕННЫЕ SKELETON LOADING СОСТОЯНИЯ */

/* Базовый skeleton с современным шиммер эффектом */
.skeleton-card,
.card.skeleton {
    background: linear-gradient(90deg, 
        var(--tg-secondary-bg-color) 0%, 
        rgba(0, 0, 0, 0.04) 50%, 
        var(--tg-secondary-bg-color) 100%);
    background-size: 200% 100%;
    animation: skeletonShimmer 1.8s ease-in-out infinite;
    border-radius: var(--radius-l);
    height: 120px;
    margin-bottom: 12px;
    box-shadow: var(--shadow-depth-1);
    overflow: hidden;
    position: relative;
}

/* Более реалистичный skeleton с элементами */
.skeleton-card-detailed {
    background-color: var(--tg-secondary-bg-color);
    border-radius: var(--radius-l);
    height: 120px;
    margin-bottom: 12px;
    padding: 16px;
    box-shadow: var(--shadow-depth-1);
    position: relative;
    overflow: hidden;
}

.skeleton-card-detailed::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.4) 50%, 
        transparent 100%);
    background-size: 200% 100%;
    animation: skeletonShimmer 2s ease-in-out infinite;
    z-index: 1;
}

/* Элементы внутри skeleton */
.skeleton-line {
    height: 12px;
    background-color: rgba(0, 0, 0, 0.08);
    border-radius: 6px;
    margin-bottom: 8px;
}

.skeleton-line.title {
    width: 70%;
    height: 16px;
    margin-bottom: 12px;
}

.skeleton-line.subtitle {
    width: 50%;
    height: 12px;
}

.skeleton-line.badge {
    width: 80px;
    height: 20px;
    border-radius: 10px;
    float: right;
    margin-top: -20px;
}

/* Анимации */
@keyframes skeletonShimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Контейнер для skeleton loading */
.skeleton-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 20px 15px;
    opacity: 0;
    animation: fadeInUp var(--transition-duration-normal) var(--ease-ultra-smooth) forwards;
}

/* Плавный переход от skeleton к контенту */
.content-replacing {
    animation: contentReplace var(--transition-duration-normal) var(--ease-ultra-smooth) forwards;
}

@keyframes contentReplace {
    0% {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
        filter: var(--blur-light);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: none;
    }
}

/* Skeleton для панели заголовка */
.skeleton-header {
    height: 24px;
    width: 150px;
    background: linear-gradient(90deg, 
        rgba(0, 0, 0, 0.08) 0%, 
        rgba(0, 0, 0, 0.12) 50%, 
        rgba(0, 0, 0, 0.08) 100%);
    background-size: 200% 100%;
    animation: skeletonShimmer 1.8s ease-in-out infinite;
    border-radius: 12px;
    margin: 20px auto;
}

/* Улучшенный прогресс бар с градиентом */
#top-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, 
        var(--tg-link-color) 0%,
        rgba(0, 122, 255, 0.8) 50%,
        var(--tg-link-color) 100%);
    background-size: 200% 100%;
    z-index: 9999;
    overflow: hidden;
    pointer-events: none;
    transform: translateZ(0);
    animation: progressSlideSmooth 1.8s ease-in-out infinite;
    opacity: 0;
    transition: opacity var(--transition-duration-fast) var(--ease-smooth);
}

#top-progress-bar:not(.hidden) {
    opacity: 1;
}

@keyframes progressSlideSmooth {
    0% { 
        transform: translateX(-100%); 
        filter: hue-rotate(0deg);
    }
    50% {
        filter: hue-rotate(30deg);
    }
    100% { 
        transform: translateX(100%); 
        filter: hue-rotate(0deg);
    }
}

/*
 * Стили для "пустых состояний" (Empty State)
 */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--tg-hint-color);
    min-height: 250px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}
.empty-state-title {
    font-size: 1.2em;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--tg-text-color);
}
/* Добавленные стили для кнопки в empty-state */
#user-orders-empty-state .button-primary {
    margin-top: 20px;
}


/*
 * Стили для полноэкранного просмотра медиа
 */
.fullscreen-media-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}
.fullscreen-media-content { max-width: 95%; max-height: 95%; object-fit: contain; }
.fullscreen-media-overlay .close-button {
    position: absolute;
    top: 15px; right: 15px;
    background: none; border: none;
    font-size: 30px;
    color: white;
    cursor: pointer;
    z-index: 2001;
}

/*
 * Стили для анимированных иконок (Lottie)
 */
.lottie-icon {
    width: 24px;
    height: 24px;
    display: inline-block;
    vertical-align: middle;
    margin-right: 6px;
}
.empty-state-icon .lottie-container {
    width: 64px;
    height: 64px;
    margin: 0 auto 16px auto;
    opacity: 0.7;
}
.lottie-order-anim {
    width: 120px;
    height: 120px;
    margin: 0 auto 12px auto;
    display: flex;
    align-items: center;
    justify-content: center;
}
.order-type-anim {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
}
.animated-emoji {
    font-size: 24px;
    line-height: 1;
    display: inline-block;
    animation: wiggle 1.1s infinite alternate;
}
@keyframes wiggle {
    0%   { transform: rotate(-10deg) scale(1); }
    100% { transform: rotate(12deg) scale(1.18); }
}

/*
 * Стили для панели "Заказы"
 */
#orders-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
    padding-top: 0; /* panel-header уже имеет padding */
    padding-bottom: 70px; /* Отступ для нижнего меню */
    overflow: hidden;
}

#orders-panel .panel-header,
#orders-panel .search-container {
    padding-left: 15px;
    padding-right: 15px;
}

.fab-create-order {
    position: fixed;
    right: 28px;
    bottom: 88px;
    z-index: 330;
    padding: 0;
    margin: 0;
    background: linear-gradient(135deg, var(--tg-link-color) 0%, rgba(0, 122, 255, 0.8) 100%);
    border: none;
    border-radius: 50%;
    box-shadow: var(--shadow-depth-3);
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    
    /* Пульсирующая анимация для привлечения внимания */
    animation: fabPulse 2s infinite;
}

@keyframes fabPulse {
    0%, 100% {
        box-shadow: var(--shadow-depth-3), 0 0 0 0 rgba(0, 122, 255, 0.4);
    }
    50% {
        box-shadow: var(--shadow-depth-4), 0 0 0 10px rgba(0, 122, 255, 0);
    }
}

.fab-create-order:hover {
    transform: translateY(-3px) scale(1.1);
    box-shadow: var(--shadow-depth-4);
    animation: none; /* Останавливаем пульсацию при hover */
}

.fab-create-order:active {
    transform: translateY(-1px) scale(1.05);
}

/*
 * Стили для модальных окон (улучшенные)
 */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.55);
    z-index: 300;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out;
}

.modal-overlay.visible {
    opacity: 1;
    pointer-events: auto;
}

.modal-window {
    background: var(--tg-bg-color);
    border-radius: var(--radius-l) var(--radius-l) 0 0;
    box-shadow: 0 -8px 40px rgba(0,0,0,0.25);
    width: 100vw;
    max-width: 100%;
    max-height: 90vh;
    padding: 30px 20px;
    padding-top: 50px;
    padding-bottom: 0;
    overflow-y: hidden;
    display: flex;
    flex-direction: column;
    position: relative;
    box-sizing: border-box;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    min-height: 200px;
    will-change: transform;
}

.modal-window h2 {
    flex-shrink: 0;
    font-size: 26px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 24px;
    color: var(--tg-text-color);
}

.modal-form-container {
    flex-grow: 1;
    overflow-y: auto;
    padding-bottom: 30px;
}

.modal-window.no-transition {
    transition: none;
}

.modal-overlay.visible .modal-window {
    transform: translateY(0);
}

.modal-window::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 5px;
    background-color: var(--tg-hint-color);
    border-radius: 2px;
    opacity: 0.6;
}

.close-modal-btn {
    position: absolute;
    right: 18px; top: 18px;
    font-size: 2.2em;
    background: none; border: none;
    color: var(--tg-hint-color); cursor: pointer; line-height: 1; padding: 0;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}
.close-modal-btn:hover {
    opacity: 1;
}
/* Исправляем padding-bottom для форм в модальных окнах */
.modal-form-container form {
    padding-bottom: 0;
    padding: 0; /* Убираем padding из самой формы, чтобы modal-form-container управлял им */
}
/* Добавьте для скрытия поля выбора клиента в модалке, если нужно */
.form-group.hidden {
    display: none !important;
}


/*
 * Стили для карусели статусов заказов (Swiper)
 */
#order-status-swiper { display: none; } /* Это, скорее всего, устаревший селектор */

.status-tabs-container {
    padding: 0 15px;
    margin-top: 10px; /* Добавлен отступ сверху, чтобы отделить от липкого заголовка */
    margin-bottom: 10px;
    flex-shrink: 0;
}

#status-tabs-swiper .swiper-slide {
    width: auto !important;
    padding: 6px 16px 6px 10px;
    border-radius: 20px;
    cursor: pointer;
    color: var(--tg-hint-color);
    background-color: var(--tg-secondary-bg-color);
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-align: center;
    display: flex;
    align-items: center;
    gap: 4px;
}

.status-tab-icon {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#status-tabs-swiper .swiper-slide.swiper-slide-thumb-active {
    color: var(--tg-button-text-color);
    background-color: var(--tg-button-color);
    box-shadow: var(--shadow-soft);
}

#orders-content-swiper {
    width: 100%;
    flex-grow: 1;
    min-height: 0;
}

#orders-content-swiper .swiper-slide {
    height: 100%;
    overflow-y: auto;
    padding: 0 15px; /* Единые отступы */
    box-sizing: border-box;
    -ms-overflow-style: none;
    scrollbar-width: none;
}
#orders-content-swiper .content-list {
    padding-left: 0;
    padding-right: 0;
}
#orders-content-swiper .swiper-slide::-webkit-scrollbar { display: none; }

/*
 * Стили для раздела "Штат"
 */
#fab-create-staff {
    position: fixed;
    right: 28px;
    bottom: 88px;
    z-index: 330;
    padding: 0;
    margin: 0;
    background: linear-gradient(135deg, var(--tg-link-color) 0%, rgba(0, 122, 255, 0.8) 100%);
    border: none;
    border-radius: 50%;
    box-shadow: var(--shadow-depth-3);
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    
    /* Пульсирующая анимация для привлечения внимания */
    animation: fabPulse 2s infinite;
}

@keyframes fabPulse {
    0%, 100% {
        box-shadow: var(--shadow-depth-3), 0 0 0 0 rgba(0, 122, 255, 0.4);
    }
    50% {
        box-shadow: var(--shadow-depth-4), 0 0 0 10px rgba(0, 122, 255, 0);
    }
}

.fab-create-staff:hover {
    transform: translateY(-3px) scale(1.1);
    box-shadow: var(--shadow-depth-4);
    animation: none; /* Останавливаем пульсацию при hover */
}

.fab-create-staff:active {
    transform: translateY(-1px) scale(1.05);
}

/*
 * УЛУЧШЕННЫЕ ПОЛЯ ВВОДА И ПОИСКА
 */
.search-input-wrapper {
    position: relative;
    margin-bottom: 20px;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.search-input-wrapper:focus-within {
    transform: translateY(-2px);
}

input[type="search"],
input[type="text"],
input[type="tel"],
input[type="email"] {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    border: 2px solid transparent;
}

input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="email"]:focus {
    border-color: var(--tg-link-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    transform: scale(1.02);
}

/*
 * УЛУЧШЕННЫЕ КАРТОЧКИ И СПИСКИ
 */

/* Базовые анимации для карточек */
.card {
    transform: translateY(20px);
    opacity: 0;
    transition: all var(--transition-duration-normal) var(--ease-out-expo);
    
    /* Улучшенные тени и hover эффекты */
    box-shadow: var(--shadow-depth-1);
    border-radius: var(--radius-l);
    overflow: hidden;
    background: var(--tg-secondary-bg-color);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

/* Анимация появления карточек */
.card.animate-in {
    transform: translateY(0);
    opacity: 1;
}

/* Стагерная анимация для списков */
.card:nth-child(1) { animation-delay: 0ms; }
.card:nth-child(2) { animation-delay: 100ms; }
.card:nth-child(3) { animation-delay: 200ms; }
.card:nth-child(4) { animation-delay: 300ms; }
.card:nth-child(5) { animation-delay: 400ms; }
.card:nth-child(6) { animation-delay: 500ms; }
.card:nth-child(7) { animation-delay: 600ms; }
.card:nth-child(8) { animation-delay: 700ms; }
.card:nth-child(9) { animation-delay: 800ms; }
.card:nth-child(10) { animation-delay: 900ms; }

/* УЛЬТРА-УЛУЧШЕННЫЕ HOVER И MICRO-INTERACTIONS */

/* Улучшенные hover эффекты для карточек */
.card {
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 122, 255, 0.05) 50%, 
        transparent 100%);
    transition: left var(--transition-duration-slow) var(--ease-elegant);
    z-index: 1;
    pointer-events: none;
}

.card:hover::before {
    left: 100%;
}

.card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: var(--shadow-depth-4);
    border-color: rgba(0, 122, 255, 0.3);
    
    /* Добавляем subtle glow эффект */
    box-shadow: 
        var(--shadow-depth-4),
        0 0 20px rgba(0, 122, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.card:active {
    transform: translateY(-3px) scale(1.01);
    transition-duration: 0.1s;
    box-shadow: var(--shadow-depth-2);
}

/* Улучшенные состояния для интерактивных элементов */
.card .card-header,
.card .card-body {
    position: relative;
    z-index: 2;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.card:hover .card-header {
    transform: translateY(-1px);
}

.card:hover .order-status-badge {
    transform: scale(1.05);
    filter: brightness(1.1) saturate(1.1);
}

/* Ripple эффект для кнопок */
.button-primary,
.button-success,
.button-danger,
.button-warning {
    position: relative;
    overflow: hidden;
}

.button-primary::after,
.button-success::after,
.button-danger::after,
.button-warning::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: all var(--transition-duration-normal) var(--ease-out-circ);
    pointer-events: none;
    opacity: 0;
}

.button-primary:active::after,
.button-success:active::after,
.button-danger:active::after,
.button-warning:active::after {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: all 0.8s var(--ease-out-circ);
}

/* Стилизованный focus для доступности */
.card:focus-visible,
.button-primary:focus-visible,
.button-success:focus-visible,
.button-danger:focus-visible,
.button-warning:focus-visible {
    outline: 2px solid var(--tg-link-color);
    outline-offset: 2px;
    box-shadow: 
        var(--shadow-depth-3),
        0 0 0 4px rgba(0, 122, 255, 0.2);
}

/* Улучшенные micro-animations для иконок */
.fa-solid,
.fa-regular {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.card:hover .fa-solid,
.card:hover .fa-regular {
    transform: scale(1.1);
    filter: brightness(1.2);
}

/* Анимация для floating action buttons */
.fab-create-order,
#fab-create-staff {
    position: relative;
}

.fab-create-order::before,
#fab-create-staff::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: inherit;
    transform: translate(-50%, -50%) scale(0);
    transition: transform var(--transition-duration-fast) var(--ease-anticipate);
    z-index: -1;
    opacity: 0.3;
}

.fab-create-order:hover::before,
#fab-create-staff:hover::before {
    transform: translate(-50%, -50%) scale(1.3);
}

/* Улучшенная анимация для пустых состояний */
.empty-state-icon {
    transition: all var(--transition-duration-normal) var(--ease-smooth);
}

.empty-state:hover .empty-state-icon {
    transform: scale(1.05) rotate(5deg);
}

/* Плавная анимация для переключения табов */
.ribbon-button {
    position: relative;
}

.ribbon-button::before {
    transition: all var(--transition-duration-normal) var(--ease-elegant);
}

.ribbon-button:not(.active):hover {
    transform: translateY(-2px) scale(1.05);
}

/* Improved loading spinner */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(0, 122, 255, 0.1);
    border-top: 3px solid var(--tg-link-color);
    border-radius: 50%;
    animation: spin 1s linear infinite, pulse 2s ease-in-out infinite alternate;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Smooth scroll improvements */
html {
    scroll-behavior: smooth;
}

/* Enhanced scrollbar styling */
::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: rgba(0, 122, 255, 0.3);
    border-radius: 3px;
    transition: background var(--transition-duration-fast) var(--ease-smooth);
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 122, 255, 0.5);
}

/* Анимация для появления карточек при загрузке */
@keyframes cardSlideIn {
    0% {
        transform: translateY(30px);
        opacity: 0;
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

.card.slide-in {
    animation: cardSlideIn var(--transition-duration-normal) var(--ease-out-expo) forwards;
}

/*
 * УЛУЧШЕННЫЕ ЭЛЕМЕНТЫ НАВИГАЦИИ
 */

/* Кнопка "Назад" */
.back-button {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--tg-hint-color);
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.back-button:hover {
    background-color: rgba(0, 122, 255, 0.1);
    color: var(--tg-link-color);
    transform: translateY(-50%) scale(1.1);
}

.back-button:active {
    transform: translateY(-50%) scale(0.95);
    background-color: rgba(0, 122, 255, 0.2);
}

/*
 * FLOATING ACTION BUTTON УЛУЧШЕНИЯ
 */
.fab-create-order,
#fab-create-staff {
    position: fixed;
    right: 28px;
    bottom: 88px;
    z-index: 330;
    padding: 0;
    margin: 0;
    background: linear-gradient(135deg, var(--tg-link-color) 0%, rgba(0, 122, 255, 0.8) 100%);
    border: none;
    border-radius: 50%;
    box-shadow: var(--shadow-depth-3);
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    
    /* Пульсирующая анимация для привлечения внимания */
    animation: fabPulse 2s infinite;
}

@keyframes fabPulse {
    0%, 100% {
        box-shadow: var(--shadow-depth-3), 0 0 0 0 rgba(0, 122, 255, 0.4);
    }
    50% {
        box-shadow: var(--shadow-depth-4), 0 0 0 10px rgba(0, 122, 255, 0);
    }
}

.fab-create-order:hover,
#fab-create-staff:hover {
    transform: translateY(-3px) scale(1.1);
    box-shadow: var(--shadow-depth-4);
    animation: none; /* Останавливаем пульсацию при hover */
}

.fab-create-order:active,
#fab-create-staff:active {
    transform: translateY(-1px) scale(1.05);
}

/*
 * УЛУЧШЕННЫЕ ПОЛЯ ВВОДА И ПОИСКА
 */
.search-input-wrapper {
    position: relative;
    margin-bottom: 20px;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.search-input-wrapper:focus-within {
    transform: translateY(-2px);
}

input[type="search"],
input[type="text"],
input[type="tel"],
input[type="email"] {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    border: 2px solid transparent;
}

input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="email"]:focus {
    border-color: var(--tg-link-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    transform: scale(1.02);
}

/*
 * Корректировки отступов для содержимого панелей
 */
#client-details-content,
#client-orders-list,
#staff-list-panel #staff-list {
    /* Эти элементы теперь получают padding-left/right от своих родительских контейнеров
       или имеют его явно прописанным там, где это необходимо. */
}

/*
 * Стили для user-panel
 */
#user-panel {
    padding-left: 0;
    padding-right: 0;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    overflow-y: auto;
    flex-grow: 1;
}

/* Выравниваем empty-state и список по центру, убираем их собственные горизонтальные отступы */
#user-panel .empty-state,
#user-panel .content-list {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

/* Возвращаем padding для содержимого внутри empty-state, чтобы текст не прилипал к краям */
#user-panel .empty-state {
    padding: 40px 20px;
}

/* Возвращаем горизонтальный padding для списка карточек внутри user-panel */
#user-panel #user-orders-list {
    padding: 15px 15px 0; /* Добавлен отступ сверху для списка заказов */
    flex-grow: 1;
}

/*
 * Стили для страницы "Связь с оператором"
 */
.contact-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 25px;
    width: 100%;
    max-width: 320px;
    margin-left: auto;
    margin-right: auto;
}

.contact-buttons-container .button-primary,
.contact-buttons-container .button-success {
    width: 100%;
    text-decoration: none;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    gap: 10px; /* Увеличенный отступ между иконкой и текстом */
}

/* Убираем лишний margin-top у оригинальной кнопки, так как теперь есть gap */
#open-operator-chat-btn {
    margin-top: 0 !important;
}

/*
 * **** НОВЫЕ ИЗМЕНЕНИЯ ДЛЯ #client-detail-panel ****
 */

/* ВАРИАНТ 2: Центрирование с анимацией через opacity (рекомендуется для простоты) */
#client-detail-panel {
    max-width: 600px; /* Установите желаемую максимальную ширину */
    width: 100%; /* Убедитесь, что она занимает 100% доступной ширины до max-width */
    left: 0; /* Прикрепить к левому краю */
    right: 0; /* Прикрепить к правому краю */
    margin-left: auto; /* Центрировать по горизонтали */
    margin-right: auto; /* Центрировать по горизонтали */
    box-sizing: border-box; /* Важно для padding */
    padding-left: 15px; /* Возвращаем отступы для содержимого */
    padding-right: 15px; /* Возвращаем отступы для содержимого */

    /* Анимация через opacity вместо transform для центрированной панели */
    opacity: 0; /* Изначально скрыто */
    pointer-events: none; /* Не реагирует на события, когда скрыто */
    transition: opacity 0.3s ease-out; /* Плавное появление/исчезновение */
    transform: none !important; /* Убираем любые трансформации по умолчанию от .panel */

    /* Изначально скрываем панель, чтобы она не появлялась до анимации */
    display: none;

}
#client-detail-panel {
    padding-bottom: 90px;
}
#client-detail-panel.visible {
    opacity: 1; /* Показываем панель */
    pointer-events: auto; /* Реагирует на события, когда видно */
    display: flex; /* Переопределяем display: none из .panel, если нужно */
}

/* Также необходимо отключить анимации скольжения для этой панели,
   если вы используете вариант с opacity, чтобы они не конфликтовали. */
/* Новые keyframes для плавного появления и исчезновения */
@keyframes panelFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes panelFadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* * Вместо отключения анимации, мы назначаем кастомную.
 * Это позволяет событию 'animationend' сработать, и JS-логика продолжит выполняться корректно.
*/
#client-detail-panel.slide-in-right,
#client-detail-panel.slide-in-left {
    animation: panelFadeIn 0.3s forwards ease-out !important;
}

#client-detail-panel.slide-out-to-left,
#client-detail-panel.slide-out-to-right {
    animation: panelFadeOut 0.3s forwards ease-out !important;
}
/* === КОНЕЦ: ИСПРАВЛЕНИЕ АНИМАЦИИ === */

/* НОВЫЕ СТИЛИ ДЛЯ ВЫРАВНИВАНИЯ #clients-panel */
#clients-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
    /* Убрали общий padding, чтобы избежать двойных отступов */
    padding: 0;
    overflow-x: hidden; /* Скрываем горизонтальный скроллбар, если что-то выходит */
    overflow-y: auto; /* Позволяем вертикальный скроллбар для содержимого */
}

#clients-panel .panel-header,
#clients-panel .search-container {
    padding-left: 15px;
    padding-right: 15px;
    box-sizing: border-box; /* Убедимся, что padding учитывается в ширине */
    width: 100%; /* Убедитесь, что эти элементы занимают всю доступную ширину */
}
#clients-panel .search-container {
    margin-top: 10px;
}

#clients-panel .content-list {
    /* Применяем padding к самому списку */
    padding-left: 15px;
    padding-right: 15px;
    flex-grow: 1; /* Позволяет списку заполнять доступное пространство */
    overflow-y: auto; /* Если список очень длинный, он будет прокручиваться сам */
    -ms-overflow-style: none; /* Скрывает скроллбар для IE/Edge */
    scrollbar-width: none; /* Скрывает скроллбар для Firefox */
    width: 100%; /* Убедитесь, что список занимает всю доступную ширину родителя с учетом padding */
    box-sizing: border-box; /* Убедимся, что padding учитывается в ширине списка */
}
#clients-panel .content-list::-webkit-scrollbar { display: none; }

/* Убедимся, что карточки внутри content-list всегда 100% ширины относительно родителя с padding */
.content-list .card {
    width: 100%;
    box-sizing: border-box; /* Повторяем на всякий случай, это критично */
    max-width: 100%;
}
/*
 * **** НОВЫЕ СТИЛИ ДЛЯ КНОПОК ВЫБОРА МЕДИА ****
 */
.media-buttons-container {
    display: flex;
    gap: 12px;
    width: 100%;
}

.button-secondary-media {
    flex: 1; /* Кнопки занимают равное пространство */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    font-size: 15px;
    font-weight: 500;
    background-color: var(--tg-bg-color);
    color: var(--tg-link-color);
    border: 1px solid var(--form-field-border-color);
    border-radius: var(--radius-m);
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s, transform 0.1s ease;
}

.button-secondary-media:hover {
    border-color: var(--tg-link-color);
    background-color: var(--tg-link-color);
    color: var(--tg-button-text-color);
}

.button-secondary-media:active {
    transform: scale(0.97);
}


/*
 * ===================================================================
 * СТИЛИ ДЛЯ НОВОЙ ПОЛНОЭКРАННОЙ ГАЛЕРЕИ (SWIPER)
 * ===================================================================
 */

/* Затемненный фон */
.fullscreen-media-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    /* Для плавного закрытия по свайпу */
    transition: background-color 0.3s ease-out;
}

/* Контейнер Swiper внутри оверлея */
#fullscreen-swiper {
    width: 100%;
    height: 100%;
    /* Для плавного возврата на место после неудачного свайпа */
    transition: transform 0.3s ease-out;
}

/* Слайд в полноэкранном режиме */
#fullscreen-swiper .swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Важно для корректной работы zoom */
}

/* Контейнер для увеличения (pinch-to-zoom) */
#fullscreen-swiper .swiper-zoom-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

#fullscreen-swiper .swiper-zoom-container img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Изображение полностью видно */
}

/* Пагинация (счетчик "3 / 10") */
.fullscreen-pagination {
    bottom: 20px !important;
    color: #fff;
    font-size: 16px;
    font-weight: 500;
    background-color: rgba(0,0,0,0.3);
    padding: 5px 12px;
    border-radius: 15px;
    /* Делаем пагинацию неширокой, чтобы она была по центру */
    width: auto !important;
    left: 50% !important;
    transform: translateX(-50%);
}

/* Класс для анимации закрытия свайпом */
.fullscreen-media-overlay.is-closing {
    background-color: transparent !important;
}
/*
 * ===================================================================
 * ИСПРАВЛЕНИЕ ВИДИМОСТИ КНОПОК И УЛУЧШЕНИЕ ИХ СТИЛЯ (НОВЫЙ БЛОК)
 * ===================================================================
 */

/*
 * ШАГ 1: Добавление новых стилей для цветных кнопок
 * * Кнопка для опасных действий (удаление, блокировка).
 * Используйте <button class="button-danger">...</button>
 */
.button-danger {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--button-danger-color);
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-danger:hover {
    filter: brightness(1.1);
}
.button-danger:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/*
 * Кнопка для действий, требующих внимания (установка стоимости, подтверждение).
 * Используйте <button class="button-warning">...</button>
 */
.button-warning {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--status-progress); /* Оранжевый цвет */
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-warning:hover {
    filter: brightness(1.1);
}
.button-warning:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/*
 * ШАГ 2: Изменение структуры панелей для "липкого" футера
 *
 * Панели с деталями теперь являются flex-контейнерами, которые не прокручиваются.
 * Прокручивается только их внутренний контент.
 */
#order-detail-panel {
    padding-bottom: 90px; /* Убираем padding-bottom у самой панели */
    /* overflow: hidden; */ /* Предотвращаем двойной скроллбар */
}


/*
 * Новый класс для обертки прокручиваемого контента.
 * Этот блок должен быть добавлен в HTML-разметку.
 */
.panel-scrollable-content {
    flex-grow: 1; /* Занимает всё доступное пространство по высоте */
    overflow-y: auto; /* Включает вертикальную прокрутку */
    padding: 0 15px; /* Боковые отступы для контента */
    padding-top: 5px;
}

/*
 * ШАГ 3: Стилизация футера с кнопками действий
 *
 * Блоки .order-detail-actions и .client-actions теперь являются "липкими" футерами.
 */
.order-detail-actions,
.client-actions {
    flex-shrink: 0; /* Запрещаем блоку сжиматься */
    display: flex;
    flex-wrap: wrap; /* Позволяем кнопкам переноситься на новую строку */
    gap: 12px; /* Расстояние между кнопками */
    padding: 15px;
    padding-bottom: calc(15px + env(safe-area-inset-bottom)); /* Безопасная зона на iPhone */
    background: linear-gradient(to top, var(--tg-bg-color) 75%, transparent); /* Градиент для плавности */
    margin: 0; /* Сбрасываем внешние отступы */
    z-index: 10;
    border-top: 1px solid var(--fieldset-border-color); /* Небольшая линия-разделитель */
}

/* Кнопки внутри футера */
.order-detail-actions button,
.client-actions button {
    flex: 1 1 160px; /* Кнопки растягиваются, но не становятся меньше 160px */
    margin: 0;
}

/* 
 * ВОССТАНОВЛЕНИЕ ЦВЕТОВ КНОПОК И ФИНАЛЬНЫЕ УЛУЧШЕНИЯ
 */

.button-primary {
    background-color: var(--tg-button-color);
    color: var(--tg-button-text-color);
}

.button-success {
    background-color: var(--button-success-color);
    color: var(--tg-button-text-color);
}

.button-danger {
    background-color: var(--button-danger-color);
    color: var(--tg-button-text-color);
}

.button-warning {
    background-color: var(--status-progress);
    color: var(--tg-button-text-color);
}

/*
 * УЛУЧШЕННЫЕ СОСТОЯНИЯ ЗАГРУЗКИ
 */

/* Красивый скелетон для карточек */
.skeleton-card {
    background: linear-gradient(90deg, 
        var(--tg-secondary-bg-color) 0%, 
        rgba(0, 0, 0, 0.04) 50%, 
        var(--tg-secondary-bg-color) 100%);
    background-size: 200% 100%;
    animation: skeletonShimmer 1.5s ease-in-out infinite;
    border-radius: var(--radius-l);
    height: 80px;
    margin-bottom: 12px;
}

@keyframes skeletonShimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* Улучшенная загрузка для списков */
.loading-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 20px;
    opacity: 0;
    animation: fadeInUp var(--transition-duration-normal) var(--ease-out-expo) forwards;
}

@keyframes fadeInUp {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Улучшенный прогресс-бар */
#top-progress-bar {
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--tg-link-color) 50%, 
        transparent 100%);
    animation: progressSlide 1.5s ease-in-out infinite;
}

@keyframes progressSlide {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/*
 * ВОССТАНОВЛЕНИЕ СТИЛЕЙ ШТАТА
 */
.staff-categories {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-top: 10px;
    padding-left: 15px;
    padding-right: 15px;
}

.role-category-btn {
    display: flex;
    align-items: center;
    width: 100%;
    text-align: left;
    padding: 16px;
    background-color: var(--tg-secondary-bg-color);
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 500;
    color: var(--tg-text-color);
    cursor: pointer;
    transition: all var(--transition-duration-fast) var(--ease-smooth);
    box-shadow: var(--shadow-depth-1);
    
    /* Добавляем эффект нажатия */
    transform: translateY(0);
}

.role-category-btn:hover {
    background-color: var(--tg-bg-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-depth-2);
}

.role-category-btn:active {
    transform: translateY(0);
}

.role-category-btn > i:first-child {
    font-size: 20px;
    color: var(--tg-link-color);
    margin-right: 16px;
    width: 24px;
    text-align: center;
}

.role-category-btn span {
    flex-grow: 1;
}

.role-category-btn > i:last-child {
    font-size: 14px;
    color: var(--tg-hint-color);
}

.staff-card .card-body {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
}

.staff-name {
    font-weight: 600;
}

.staff-phone {
    color: var(--tg-hint-color);
    font-size: 0.9em;
    display: block;
}

.swipe-indicator {
    color: var(--tg-hint-color);
    opacity: 0.6;
    font-size: 14px;
}

/* Восстановление стилей FAB */
.fab-create-order span#fab-plus-lottie,
#fab-create-staff span {
    display: block;
    width: 40px !important;
    height: 40px !important;
    pointer-events: none;
}

/*
 * ДОПОЛНИТЕЛЬНЫЕ АНИМАЦИИ ДЛЯ ПЛАВНОСТИ
 */

/* Анимация для пустых состояний */
.empty-state {
    opacity: 0;
    transform: translateY(30px);
    animation: emptyStateAppear var(--transition-duration-slow) var(--ease-out-expo) forwards;
}

@keyframes emptyStateAppear {
    0% {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Анимация для модальных окон */
.modal-overlay {
    backdrop-filter: blur(0px);
    transition: backdrop-filter var(--transition-duration-normal) var(--ease-smooth);
}

.modal-overlay:not(.hidden) {
    backdrop-filter: blur(8px);
}

.modal-window {
    transform: translateY(100%) scale(0.9);
    transition: all var(--transition-duration-normal) var(--ease-out-expo);
}

.modal-overlay:not(.hidden) .modal-window {
    transform: translateY(0) scale(1);
}

/* Улучшенные переходы для Swiper */
.swiper-slide {
    transition: all var(--transition-duration-fast) var(--ease-smooth);
}

.swiper-slide-active {
    transform: scale(1);
}

.swiper-slide:not(.swiper-slide-active) {
    transform: scale(0.95);
    opacity: 0.7;
}

/*
 * =====================================================================
 * СТАБИЛИЗАЦИЯ LAYOUT - ПРЕДОТВРАЩЕНИЕ LAYOUT SHIFT
 * =====================================================================
 */

/* Минимальные высоты для основных контейнеров */
.content-list {
    min-height: 200px; /* Предотвращает collapse при пустом списке */
    transition: min-height var(--transition-duration-normal) var(--ease-smooth);
}

.panel-header {
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.search-container {
    min-height: 80px;
    display: flex;
    align-items: center;
}

/* Placeholder для содержимого во время загрузки */
.content-placeholder {
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    animation: fadeInUp var(--transition-duration-normal) var(--ease-ultra-smooth) forwards;
}

/* Стабильные размеры для карточек */
.card {
    min-height: 100px;
    contain: layout style; /* CSS containment для лучшей производительности */
}

.skeleton-card,
.skeleton-card-detailed {
    height: 120px; /* Фиксированная высота для предсказуемости */
    min-height: 120px;
}

/* Предотвращение layout shift для изображений и медиа */
.media-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
    background-color: var(--tg-bg-color); /* Placeholder цвет */
}

/* Стабилизация для модальных окон */
.modal-window {
    min-height: 200px;
    max-height: 90vh;
    will-change: transform;
}

/* Улучшенная стабилизация для Swiper */
.swiper-container {
    min-height: 50px;
}

.swiper-slide {
    height: auto;
    min-height: inherit;
}

/* Резервируем место для FAB кнопок */
body {
    padding-bottom: 100px; /* Место для нижней панели + FAB */
}

.panel {
    padding-bottom: 120px; /* Увеличиваем нижний отступ */
}

/* Стабилизация для пустых состояний */
.empty-state {
    min-height: 250px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* Устраняем CLS (Cumulative Layout Shift) */
.panel-content,
.content-list,
.empty-state,
.skeleton-container {
    contain: layout style paint;
}

/*
 * =====================================================================
 * ФИНАЛЬНЫЕ ОПТИМИЗАЦИИ ПРОИЗВОДИТЕЛЬНОСТИ
 * =====================================================================
 */

/* GPU acceleration для ключевых элементов */
.panel,
.card,
.modal-overlay,
.fullscreen-media-overlay,
.fab-create-order,
#fab-create-staff,
.bottom-ribbon {
    will-change: transform;
    transform: translateZ(0); /* Принуждаем к композитному слою */
}

/* Оптимизация перерисовки */
.panel-header,
.search-container,
.content-list {
    contain: layout style;
}

/* Reduced motion для пользователей с предпочтениями доступности */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    
    .card::before,
    .button-primary::after,
    .button-success::after,
    .button-danger::after,
    .button-warning::after {
        display: none;
    }
}

/* Оптимизации для старых браузеров */
.panel {
    -webkit-transform: translateZ(0);
    -moz-transform: translateZ(0);
    -ms-transform: translateZ(0);
    transform: translateZ(0);
}

/* Улучшенная типографика для лучшей читаемости */
.card-header,
.card-body,
.panel-header h2 {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Critical rendering path optimization */
.above-fold-content {
    contain: layout style paint;
    will-change: contents;
}

/* Финальная CSS оптимизация */
* {
    box-sizing: border-box;
}

*:focus {
    outline-offset: 2px;
}

/* Улучшенная поддержка темной темы */
@media (prefers-color-scheme: dark) {
    :root {
        --tg-bg-color: #1a1a1a;
        --tg-secondary-bg-color: #2a2a2a;
        --shadow-depth-1: 0 1px 3px rgba(255, 255, 255, 0.1), 0 1px 2px rgba(255, 255, 255, 0.06);
        --shadow-depth-2: 0 3px 6px rgba(255, 255, 255, 0.12), 0 3px 6px rgba(255, 255, 255, 0.08);
        --shadow-depth-3: 0 10px 20px rgba(255, 255, 255, 0.15), 0 6px 6px rgba(255, 255, 255, 0.1);
        --shadow-depth-4: 0 14px 28px rgba(255, 255, 255, 0.18), 0 10px 10px rgba(255, 255, 255, 0.12);
    }
}

/* Финальная оптимизация для мобильных устройств */
@media (max-width: 768px) {
    .card:hover {
        transform: translateY(-3px) scale(1.01); /* Уменьшаем hover эффект на мобильных */
    }
    
    .transition-duration-slow {
        --transition-duration-slow: 0.5s; /* Быстрее на мобильных */
    }
}