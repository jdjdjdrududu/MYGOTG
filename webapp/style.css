/*
 * Глобальные переменные и основные стили
 * Используются для определения цветовой палитры, типографики,
 * радиусов скругления и теней, а также статусов.
 */
:root {
    /* Цвета Telegram Theme */
    --tg-bg-color: var(--tg-theme-bg-color, #f7f8fa);
    --tg-text-color: var(--tg-theme-text-color, #000000);
    --tg-hint-color: var(--tg-theme-hint-color, #707579);
    --tg-link-color: var(--tg-theme-link-color, #007aff);
    --tg-button-color: var(--tg-theme-button-color, #007aff);
    --tg-button-text-color: var(--tg-theme-button-text-color, #ffffff);
    --tg-secondary-bg-color: var(--tg-theme-secondary-bg-color, #ffffff);

    /* Типографика */
    --font-family: -apple-system, BlinkMacMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;

    /* Скругления */
    --radius-s: 8px; /* Немного увеличено */
    --radius-m: 14px; /* Увеличено для более гладкого вида */
    --radius-l: 22px; /* Увеличено для более современного вида */

    /* Тени */
    --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08); /* Чуть заметнее, но мягче */
    --shadow-strong: 0 8px 30px rgba(0, 0, 0, 0.18); /* Усилено для акцента */

    /* Цвета статусов */
    --status-new: #007aff; /* Синий */
    --status-progress: #ff9500; /* Оранжевый */
    --status-completed: #34c759; /* Зеленый */
    --status-canceled: #ff3b30; /* Красный */
    --status-awaiting: #ffcc00; /* Желтый */
    --status-calculated: #5856d6; /* Фиолетовый */

    /* Цвета кнопок действия */
    --button-danger-color: #ff3b30;
    --button-success-color: #34c759;

    /* Новые переменные для форм (уточненные) */
    --form-field-bg: var(--tg-secondary-bg-color);
    --form-field-border-color: #e6e6e6; /* Легче для чистого вида */
    --form-field-focus-border: var(--tg-link-color);
    --form-field-placeholder-color: var(--tg-hint-color);
    --form-group-gap: 20px; /* Увеличим отступ между группами полей */
    --fieldset-border-color: #e0e0e0; /* Легкий серый для разделителя fieldset */
}

/* === НОВЫЙ СТИЛЬ: для отключенных кнопок === */
.button-disabled,
button:disabled {
    cursor: not-allowed !important;
    opacity: 0.65 !important;
    pointer-events: none; /* Предотвращаем любые события */
}
/* === КОНЕЦ НОВОГО СТИЛЯ === */

.button-primary {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--tg-button-color);
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}

.button-primary:hover {
    filter: brightness(1.1);
}

.button-primary:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/* === НОВЫЙ БЛОК ДЛЯ button-success (добавлен для кнопки "Позвонить") === */
.button-success {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--button-success-color); /* Используем зеленую переменную */
    color: var(--tg-button-text-color); /* Текст белый */
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}

.button-success:hover {
    filter: brightness(1.1);
}

.button-success:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}
/* === КОНЕЦ: ВСТАВЬТЕ ЭТОТ БЛОК === */


/*
 * Основные стили для `body`
 */
body {
    font-family: var(--font-family);
    background-color: var(--tg-bg-color);
    color: var(--tg-text-color);
    margin: 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
}

/*
 * Контейнер приложения и управление панелями
 */
#app-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.panel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--tg-bg-color);
    overflow-y: auto;
    padding-bottom: 90px; /* Отступ для нижнего меню */
    box-sizing: border-box;
    transform: translateX(100%);
    display: none;
    will-change: transform;
    flex-direction: column;
}

/* Переопределение padding для панелей, управляющих им внутренне */
#orders-panel,
#user-panel,
#clients-panel,
#client-detail-panel,
#staff-hub-panel,
#staff-list-panel,
#order-detail-panel,
#user-order-creation-panel,
#order-creation-panel,
#contact-operator-panel {
    padding-left: 0;
    padding-right: 0;
    padding-top: 0;
    /* Это изменение оставляет padding-bottom: 90px из класса .panel, решая проблему */
}

/*
 * ШАГ 2: Стили для цветных кнопок (оставляем их, так как они полезны)
 */

/* Кнопка для опасных действий (красная) */
.button-danger {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--button-danger-color);
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-danger:hover {
    filter: brightness(1.1);
}
.button-danger:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/* Кнопка для действий, требующих внимания (оранжевая) */
.button-warning {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--status-progress); /* Оранжевый цвет */
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-warning:hover {
    filter: brightness(1.1);
}
.button-warning:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

.panel.visible {
    transform: translateX(0);
    display: flex;
}

.panel.no-transition {
    transition: none !important;
}

/*
 * Анимации переходов панелей
 */
@keyframes slide-in-from-right {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}
@keyframes slide-out-to-left {
    from { transform: translateX(0); }
    to { transform: translateX(-100%); }
}
@keyframes slide-in-from-left {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
}
@keyframes slide-out-to-right {
    from { transform: translateX(0); }
    to { transform: translateX(100%); }
}

.slide-in-right { animation: slide-in-from-right 0.3s forwards ease-out; }
.slide-out-to-left { animation: slide-out-to-left 0.3s forwards ease-out; }
.slide-in-left { animation: slide-in-from-left 0.3s forwards ease-out; }
.slide-out-to-right { animation: slide-out-to-right 0.3s forwards ease-out; }

/* Утилитарный класс для скрытия элементов */
.hidden { display: none !important; }

/*
 * Стили заголовков панелей
 */
.panel-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    background-color: var(--tg-bg-color);
    padding: 15px;
    box-shadow: var(--shadow-soft);
    position: sticky;
    top: 0;
    z-index: 10;
    flex-shrink: 0;
    width: 100%; /* Убедитесь, что занимает всю ширину */
    box-sizing: border-box; /* Включает padding в ширину */
}

.panel-header h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    flex-grow: 0;
}

.back-button {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--tg-hint-color);
    cursor: pointer;
    padding: 0;
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
}

/*
 * Стили для фильтров и поиска
 */
.filters-container {
    overflow-x: auto;
    white-space: nowrap;
    padding: 5px 0;
    -ms-overflow-style: none;
    scrollbar-width: none;
}
.filters-container::-webkit-scrollbar { display: none; }

.status-filter-btn {
    display: inline-block;
    padding: 8px 16px;
    margin-right: 8px;
    border: 1px solid var(--tg-hint-color);
    background-color: transparent;
    color: var(--tg-link-color);
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
}
.status-filter-btn.active {
    background-color: var(--tg-button-color);
    color: var(--tg-button-text-color);
    border-color: var(--tg-button-color);
}

.search-container {
    padding: 0 15px; /* Единые отступы */
    margin-bottom: 16px;
    width: 100%;
    box-sizing: border-box;
}
.search-input-wrapper {
    position: relative;
}
.lottie-search-icon {
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    pointer-events: none;
}
.search-container input {
    width: 100%;
    padding: 12px 16px 12px 56px;
    border: 1px solid transparent;
    border-radius: var(--radius-l);
    background-color: var(--tg-secondary-bg-color);
    color: var(--tg-text-color);
    box-sizing: border-box;
    font-size: 16px;
    box-shadow: var(--shadow-soft);
}
.search-container input:focus {
    outline: none;
    border-color: var(--tg-link-color);
}

/*
 * Стили для списка контента и карточек
 */
.content-list {
    list-style-type: none;
    padding: 0 15px; /* Единые отступы для списков */
    margin: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
    box-sizing: border-box;
}

.card {
    width: 100%;
    box-sizing: border-box;

    background-color: var(--tg-secondary-bg-color);
    border-radius: var(--radius-l);
    padding: 16px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-shadow: var(--shadow-soft);
    border: 1px solid #E9EDF5;
}
.card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-strong);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}
.order-id {
    font-weight: 600;
    font-size: 1.1em;
}
.order-status-badge {
    font-size: 0.8em;
    padding: 4px 10px;
    border-radius: 12px;
    color: #fff;
    font-weight: 600;
    text-transform: capitalize;
}
/* Цвета бейджей статусов */
.order-status-badge[data-status="new"],
.order-status-badge[data-status="awaiting_cost"] { background-color: var(--status-new); }
.order-status-badge[data-status="in_progress"] { background-color: var(--status-progress); }
.order-status-badge[data-status="awaiting_confirmation"],
.order-status-badge[data-status="awaiting_payment"] { background-color: var(--status-awaiting); color: #000; }
.order-status-badge[data-status="completed"],
.order-status-badge[data-status="settled"] { background-color: var(--status-completed); }
.order-status-badge[data-status="calculated"] { background-color: var(--status-calculated); }
.order-status-badge[data-status="canceled"] { background-color: var(--status-canceled); }

.card-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95em;
    color: var(--tg-text-color);
}
.info-item i {
    color: var(--tg-hint-color);
    width: 16px;
    text-align: center;
}
.card-footer {
    display: flex;
    justify-content: space-between;
    margin-top: 12px;
    font-size: 0.9em;
    color: var(--tg-hint-color);
}
.client-name, .executor-name { font-weight: 600; }
.client-info, .executor-role, .executor-status { color: var(--tg-hint-color); font-size: 0.9em; }

/*
 * Стили для форм (НОВАЯ, ИСПРАВЛЕННАЯ ВЕРСИЯ)
 */
.form-content-wrapper {
    flex-grow: 1;
    overflow-y: auto;
    padding: 16px 15px 0 15px; /* Добавлен отступ сверху */
    display: flex;
    flex-direction: column;
}

form {
    display: flex;
    flex-direction: column;
    gap: 16px; /* Отступ между fieldset */
    padding-bottom: 120px; /* Отступ снизу, чтобы кнопка не перекрывала последнее поле */
}

fieldset {
    border: none;
    border-radius: var(--radius-m);
    padding: 20px 16px 16px;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--form-group-gap);
    background-color: var(--form-field-bg);
    box-shadow: var(--shadow-soft);
    position: relative;
    min-width: 0; /* <<<===== ГЛАВНЫЙ ФИКС ЗДЕСЬ */
}

legend {
    /* Полностью переработанная легенда */
    font-size: 1.2em; /* Четкий, видимый размер */
    font-weight: 700;
    color: var(--tg-text-color); /* Основной цвет текста */
    margin-bottom: 16px; /* Отступ после заголовка */
    padding: 0;
    width: 100%;
    /* Убираем все старые хаки с позиционированием */
}

.form-group {
    display: flex;
    flex-direction: column;
    position: relative;
}

/* Статичная метка, для которой не нужна анимация */
.form-group .static-label {
    font-size: 0.9em;
    color: var(--tg-hint-color);
    margin-bottom: 8px;
    font-weight: 500;
}

.form-group label:not(.static-label) {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1em; /* Увеличен базовый размер шрифта метки */
    color: var(--tg-hint-color);
    pointer-events: none;
    transition: all 0.2s ease-out;
    background-color: var(--form-field-bg);
    padding: 0 4px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 18px 16px 10px 16px; /* Скорректирован padding для метки */
    border: 1px solid var(--form-field-border-color);
    border-radius: var(--radius-s);
    background-color: var(--form-field-bg);
    color: var(--tg-text-color);
    box-sizing: border-box;
    font-size: 16px;
    font-family: var(--font-family);
    transition: all 0.2s ease;
    -webkit-appearance: none; /* Убираем стандартный вид для iOS */
}

/* Эффект плавающей метки: поднятие и изменение стиля */
.form-group input:focus + label:not(.static-label),
.form-group textarea:focus + label:not(.static-label),
.form-group select:focus + label:not(.static-label),
.form-group input:not(:placeholder-shown) + label:not(.static-label),
.form-group textarea:not(:placeholder-shown) + label:not(.static-label),
.form-group select:valid + label:not(.static-label) { /* Исправлено для select */
    top: 0; /* Позиция вверху */
    font-size: 0.8em; /* Размер вверху */
    color: var(--tg-link-color);
    transform: translateY(-50%);
}

/* Специальные стили для date/time инпутов, у которых нет :placeholder-shown */
.form-group input[type="date"] + label,
.form-group input[type="time"] + label {
    top: 0;
    font-size: 0.8em;
    transform: translateY(-50%);
    color: var(--tg-link-color);
}

.form-group select:invalid {
    color: var(--tg-hint-color);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: transparent; /* Скрываем стандартный placeholder */
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--form-field-focus-border);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15); /* Мягкий фокус-эффект */
}

/* НОВЫЙ СТИЛЬ: Скрываем пустой option-плейсхолдер из выпадающего списка */
select:required option[value=""] {
    display: none;
}

.form-group-inline {
    display: flex;
    gap: var(--form-group-gap);
}
.form-group-inline > .form-group {
    flex: 1;
}

/*
 * ===================================================================
 * ИСПРАВЛЕННЫЕ И ОБЪЕДИНЕННЫЕ СТИЛИ ДЛЯ КАРУСЕЛИ МЕДИАФАЙЛОВ
 * ===================================================================
 */

/* Главный контейнер для карусели превью ("окно" просмотра) */
.media-preview-swiper {
    position: relative;
    width: 100%;
    min-width: 0;
    border-radius: var(--radius-m);
    margin-bottom: 12px;
    box-sizing: border-box;
    border: 2px dashed var(--form-field-border-color);
    transition: border-color 0.3s ease;
    overflow: hidden;
    background-color: rgba(0,0,0,0.02);
}

/* Меняем границу, когда в карусели появляются файлы */
.media-preview-swiper.swiper-initialized {
    border-style: solid;
}

/* Обертка для слайдов, которую создает Swiper (прокручиваемая область) */
.media-preview-swiper .swiper-wrapper {
    height: 120px; /* Задаем высоту здесь, а не на родительском контейнере */
    align-items: center; /* Выравниваем слайды по центру по вертикали */
    padding: 0 10px; /* Добавляем горизонтальный отступ по краям карусели */
    box-sizing: border-box;
}

/* Стилизация каждого слайда-превью */
.media-preview-swiper .swiper-slide {
    width: 100px !important; /* Фиксированная ширина */
    height: 100px; /* Фиксированная высота */
    flex-shrink: 0; /* Запрещаем сжиматься внутри flex-контейнера */
    border-radius: var(--radius-s);
    overflow: hidden;
    background-color: var(--tg-bg-color);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Контейнер для изображения/видео внутри слайда */
.media-preview-swiper .media-item {
    width: 100%;
    height: 100%;
}

/* Изображение или видео внутри превью */
.media-preview-swiper .media-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Изображение/видео полностью заполняет контейнер, обрезая лишнее */
    display: block; /* Убираем лишние пробелы под img/video */
}

/* Кнопка удаления медиа поверх превью */
.delete-media-button {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    border: none;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
    line-height: 1;
    z-index: 10;
}
.delete-media-button:hover {
    background-color: rgba(255, 59, 48, 0.8); /* Красный при наведении */
    transform: scale(1.1);
}

/* Пагинация (точки) для Swiper */
.media-preview-swiper .swiper-pagination {
    bottom: 5px !important; /* Позиционируем относительно низа .swiper-wrapper */
}

.media-preview-swiper .swiper-pagination-bullet {
    background-color: var(--tg-hint-color);
    opacity: 0.4;
    transition: all 0.3s ease;
    width: 6px;
    height: 6px;
}

.media-preview-swiper .swiper-pagination-bullet-active {
    background-color: var(--tg-link-color);
    opacity: 1;
    transform: scale(1.2);
}

/* Скрываем стрелки навигации, если они есть по умолчанию */
.swiper-button-next, .swiper-button-prev {
    display: none !important;
}

/*
 * ===================================================================
 * КОНЕЦ ИСПРАВЛЕННЫХ СТИЛЕЙ ДЛЯ КАРУСЕЛИ
 * ===================================================================
 */

.form-actions {
    /* Делаем блок с кнопкой "липким" */
    position: sticky;
    bottom: 0;
    background: linear-gradient(to top, var(--tg-bg-color) 85%, transparent); /* Градиент для плавного перехода */
    padding: 20px 0; /* Отступы сверху и снизу */
    width: 100%;
    z-index: 20;
    margin-top: auto; /* Прижимает блок к низу flex-контейнера */
}

.form-actions .button-primary {
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    display: block;
    box-shadow: var(--shadow-strong); /* Добавляем тень для лучшей видимости */
}


/*
 * Стили для деталей (клиентов, заказов)
 */
#client-details-content {
    padding: 25px; /* Увеличено для большего внутреннего отступа */
}
#order-details-content {
    background-color: var(--tg-secondary-bg-color);
    padding: 20px;
    border-radius: var(--radius-l);
    margin: 15px;
    box-shadow: var(--shadow-soft);
    box-sizing: border-box;
    width: calc(100% - 30px);
}
.client-details-grid dl, .details-grid dl {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 18px 15px; /* Увеличено для вертикального отступа */
    margin: 0;
    padding: 0;
}
.client-details-grid dt, .details-grid dt {
    font-weight: 500;
    color: var(--tg-hint-color);
    white-space: nowrap; /* Предотвращаем перенос заголовков */
}
.client-details-grid dd, .details-grid dd {
    margin: 0;
    font-size: 16px;
    word-break: break-word; /* Изменено на break-word для лучшего переноса */
    text-align: right; /* Выравнивание по правому краю для аккуратности */
}
.details-grid dd.editable {
    color: var(--tg-link-color);
    cursor: pointer;
    text-decoration: none;
    border-bottom: 1px dashed var(--tg-link-color);
}
.client-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 0; /* Убираем лишний отступ */
    margin-top: 20px;
    padding: 0 15px 15px 15px; /* Единые отступы */
}
.client-actions .button-primary {
    flex: 1;
    text-align: center;
}

#client-detail-panel h3, #order-detail-panel h3 {
    margin-top: 25px;
    margin-bottom: 15px;
    font-size: 1.1em;
    font-weight: 600;
    padding: 0 15px; /* Единые отступы */
}
/* Контейнер-обертка для создания рамки, как при создании заказа */
.media-gallery-container {
    margin: 0 15px; /* Боковые отступы, чтобы соответствовать остальному контенту */
    padding: 12px;  /* Внутренний отступ для "воздуха" вокруг фото */
    border: 2px dashed var(--form-field-border-color); /* Такая же рамка, как при создании заказа */
    border-radius: var(--radius-m);
    background-color: rgba(0, 0, 0, 0.02);
    box-sizing: border-box;
}

/* Измененные стили для самой галереи, которая теперь находится внутри обертки */
#order-detail-media-gallery {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding: 0; /* Весь padding теперь на .media-gallery-container */
    -webkit-overflow-scrolling: touch; /* Плавный скролл на iOS */
    -ms-overflow-style: none;  /* Скрыть скроллбар для IE и Edge */
    scrollbar-width: none;  /* Скрыть скроллбар для Firefox */
}

#order-detail-media-gallery::-webkit-scrollbar {
    display: none; /* Скрыть скроллбар для WebKit */
}

.media-item {
    flex-shrink: 0;
    width: 120px;
    height: 120px;
    position: relative;
    border-radius: var(--radius-m);
    overflow: hidden;
    background-color: var(--tg-bg-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.media-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.media-type-icon {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: rgba(0,0,0,0.5);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}
#add-media-btn {
    width: calc(100% - 30px);
    margin: 20px 15px 30px 15px;
    padding: 16px 28px;
    box-sizing: border-box;
}
.executor-card .card-body {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
}

/*
 * Нижняя навигационная панель (Bottom Ribbon)
 */
.bottom-ribbon {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: var(--tg-secondary-bg-color);
    border-top: 1px solid var(--tg-bg-color);
    display: flex;
    justify-content: space-around;
    padding: 5px;
    box-sizing: border-box;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    z-index: 100;
}
.ribbon-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    max-width: 120px;
    padding: 8px 0;
    font-size: 12px;
    font-weight: 500;
    background-color: transparent;
    color: var(--tg-hint-color);
    border: none;
    cursor: pointer;
    border-radius: var(--radius-m);
    transition: color 0.2s, background-color 0.2s;
    text-align: center;
    gap: 4px;
}
.ribbon-button:hover,
.ribbon-button.active {
    background-color: var(--tg-bg-color);
    color: var(--tg-link-color);
}
.ribbon-button i {
    font-size: 20px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Стили для активной кнопки в нижнем меню */
.bottom-ribbon .ribbon-button.active {
    color: var(--tg-button-color);
}

/*
 * Стили для загрузчиков (Spinners)
 */
#top-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px; /* Высота полосы */
    background-color: transparent; /* Фон-контейнер прозрачный */
    z-index: 9999; /* Высший z-index, чтобы быть поверх всего */
    overflow: hidden;
    pointer-events: none; /* Не мешает кликам */
    transform: translateZ(0); /* Аппаратное ускорение */
}

#top-progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--tg-button-color, #007aff); /* Цвет полосы */
    animation: progress-animation 1.5s infinite linear;
}

@keyframes progress-animation {
    0% {
        transform: translateX(-100%) scaleX(0.5);
    }
    50% {
        transform: translateX(0%) scaleX(1);
    }
    100% {
        transform: translateX(100%) scaleX(0.5);
    }
}

/* Стили для скелетного загрузчика */
.card.skeleton {
    height: 140px;
    animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    background-color: var(--tg-bg-color);
}
@keyframes pulse {
    50% { opacity: .7; }
}

/*
 * Стили для "пустых состояний" (Empty State)
 */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--tg-hint-color);
}
.empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}
.empty-state-title {
    font-size: 1.2em;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--tg-text-color);
}
/* Добавленные стили для кнопки в empty-state */
#user-orders-empty-state .button-primary {
    margin-top: 20px;
}


/*
 * Стили для полноэкранного просмотра медиа
 */
.fullscreen-media-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}
.fullscreen-media-content { max-width: 95%; max-height: 95%; object-fit: contain; }
.fullscreen-media-overlay .close-button {
    position: absolute;
    top: 15px; right: 15px;
    background: none; border: none;
    font-size: 30px;
    color: white;
    cursor: pointer;
    z-index: 2001;
}

/*
 * Стили для анимированных иконок (Lottie)
 */
.lottie-icon {
    width: 24px;
    height: 24px;
    display: inline-block;
    vertical-align: middle;
    margin-right: 6px;
}
.empty-state-icon .lottie-container {
    width: 64px;
    height: 64px;
    margin: 0 auto 16px auto;
    opacity: 0.7;
}
.lottie-order-anim {
    width: 120px;
    height: 120px;
    margin: 0 auto 12px auto;
    display: flex;
    align-items: center;
    justify-content: center;
}
.order-type-anim {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
}
.animated-emoji {
    font-size: 24px;
    line-height: 1;
    display: inline-block;
    animation: wiggle 1.1s infinite alternate;
}
@keyframes wiggle {
    0%   { transform: rotate(-10deg) scale(1); }
    100% { transform: rotate(12deg) scale(1.18); }
}

/*
 * Стили для панели "Заказы"
 */
#orders-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
    padding-top: 0; /* panel-header уже имеет padding */
    padding-bottom: 70px; /* Отступ для нижнего меню */
    overflow: hidden;
}

#orders-panel .panel-header,
#orders-panel .search-container {
    padding-left: 15px;
    padding-right: 15px;
}

.fab-create-order {
    position: fixed;
    right: 28px;
    bottom: 88px;
    z-index: 330;
    padding: 0;
    margin: 0;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    width: auto;
    height: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}
.fab-create-order span#fab-plus-lottie {
    display: block;
    width: 60px !important;
    height: 60px !important;
    pointer-events: none;
}
.fab-create-order:active {
    background: transparent !important;
}

/*
 * Стили для модальных окон (улучшенные)
 */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.55);
    z-index: 300;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out;
}

.modal-overlay.visible {
    opacity: 1;
    pointer-events: auto;
}

.modal-window {
    background: var(--tg-bg-color);
    border-radius: var(--radius-l) var(--radius-l) 0 0;
    box-shadow: 0 -8px 40px rgba(0,0,0,0.25);
    width: 100vw;
    max-width: 100%;
    max-height: 90vh;
    padding: 30px 20px;
    padding-top: 50px;
    padding-bottom: 0;
    overflow-y: hidden;
    display: flex;
    flex-direction: column;
    position: relative;
    box-sizing: border-box;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.modal-window h2 {
    flex-shrink: 0;
    font-size: 26px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 24px;
    color: var(--tg-text-color);
}

.modal-form-container {
    flex-grow: 1;
    overflow-y: auto;
    padding-bottom: 30px;
}

.modal-window.no-transition {
    transition: none;
}

.modal-overlay.visible .modal-window {
    transform: translateY(0);
}

.modal-window::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 5px;
    background-color: var(--tg-hint-color);
    border-radius: 2px;
    opacity: 0.6;
}

.close-modal-btn {
    position: absolute;
    right: 18px; top: 18px;
    font-size: 2.2em;
    background: none; border: none;
    color: var(--tg-hint-color); cursor: pointer; line-height: 1; padding: 0;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}
.close-modal-btn:hover {
    opacity: 1;
}
/* Исправляем padding-bottom для форм в модальных окнах */
.modal-form-container form {
    padding-bottom: 0;
    padding: 0; /* Убираем padding из самой формы, чтобы modal-form-container управлял им */
}
/* Добавьте для скрытия поля выбора клиента в модалке, если нужно */
.form-group.hidden {
    display: none !important;
}


/*
 * Стили для карусели статусов заказов (Swiper)
 */
#order-status-swiper { display: none; } /* Это, скорее всего, устаревший селектор */

.status-tabs-container {
    padding: 0 15px;
    margin-top: 10px; /* Добавлен отступ сверху, чтобы отделить от липкого заголовка */
    margin-bottom: 10px;
    flex-shrink: 0;
}

#status-tabs-swiper .swiper-slide {
    width: auto !important;
    padding: 6px 16px 6px 10px;
    border-radius: 20px;
    cursor: pointer;
    color: var(--tg-hint-color);
    background-color: var(--tg-secondary-bg-color);
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-align: center;
    display: flex;
    align-items: center;
    gap: 4px;
}

.status-tab-icon {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#status-tabs-swiper .swiper-slide.swiper-slide-thumb-active {
    color: var(--tg-button-text-color);
    background-color: var(--tg-button-color);
    box-shadow: var(--shadow-soft);
}

#orders-content-swiper {
    width: 100%;
    flex-grow: 1;
    min-height: 0;
}

#orders-content-swiper .swiper-slide {
    height: 100%;
    overflow-y: auto;
    padding: 0 15px; /* Единые отступы */
    box-sizing: border-box;
    -ms-overflow-style: none;
    scrollbar-width: none;
}
#orders-content-swiper .content-list {
    padding-left: 0;
    padding-right: 0;
}
#orders-content-swiper .swiper-slide::-webkit-scrollbar { display: none; }

/*
 * Стили для раздела "Штат"
 */
#fab-create-staff {
    position: fixed;
    right: 28px;
    bottom: 88px;
    z-index: 330;
    padding: 0;
    margin: 0;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    width: auto;
    height: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

#fab-create-staff span {
    display: block;
    width: 60px !important;
    height: 60px !important;
    pointer-events: none;
}

.staff-categories {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-top: 10px;
    padding-left: 15px;
    padding-right: 15px;
}

.role-category-btn {
    display: flex;
    align-items: center;
    width: 100%;
    text-align: left;
    padding: 16px;
    background-color: var(--tg-secondary-bg-color);
    border: none;
    border-radius: var(--radius-m);
    font-size: 16px;
    font-weight: 500;
    color: var(--tg-text-color);
    cursor: pointer;
    transition: background-color 0.2s ease;
    box-shadow: var(--shadow-soft);
}

.role-category-btn:hover {
    background-color: var(--tg-bg-color);
}

.role-category-btn > i:first-child {
    font-size: 20px;
    color: var(--tg-link-color);
    margin-right: 16px;
    width: 24px;
    text-align: center;
}

.role-category-btn span {
    flex-grow: 1;
}

.role-category-btn > i:last-child {
    font-size: 14px;
    color: var(--tg-hint-color);
}

.staff-card .card-body {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
}

.staff-name {
    font-weight: 600;
}
.staff-phone {
    color: var(--tg-hint-color);
    font-size: 0.9em;
    display: block;
}

.swipe-indicator {
    color: var(--tg-hint-color);
    opacity: 0.6;
    font-size: 14px;
}

/*
 * Корректировки отступов для содержимого панелей
 */
#client-details-content,
#client-orders-list,
#staff-list-panel #staff-list {
    /* Эти элементы теперь получают padding-left/right от своих родительских контейнеров
       или имеют его явно прописанным там, где это необходимо. */
}

/*
 * Стили для user-panel
 */
#user-panel {
    padding-left: 0;
    padding-right: 0;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    overflow-y: auto;
    flex-grow: 1;
}

/* Выравниваем empty-state и список по центру, убираем их собственные горизонтальные отступы */
#user-panel .empty-state,
#user-panel .content-list {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

/* Возвращаем padding для содержимого внутри empty-state, чтобы текст не прилипал к краям */
#user-panel .empty-state {
    padding: 40px 20px;
}

/* Возвращаем горизонтальный padding для списка карточек внутри user-panel */
#user-panel #user-orders-list {
    padding: 15px 15px 0; /* Добавлен отступ сверху для списка заказов */
    flex-grow: 1;
}

/*
 * Стили для страницы "Связь с оператором"
 */
.contact-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 25px;
    width: 100%;
    max-width: 320px;
    margin-left: auto;
    margin-right: auto;
}

.contact-buttons-container .button-primary,
.contact-buttons-container .button-success {
    width: 100%;
    text-decoration: none;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    gap: 10px; /* Увеличенный отступ между иконкой и текстом */
}

/* Убираем лишний margin-top у оригинальной кнопки, так как теперь есть gap */
#open-operator-chat-btn {
    margin-top: 0 !important;
}

/*
 * **** НОВЫЕ ИЗМЕНЕНИЯ ДЛЯ #client-detail-panel ****
 */

/* ВАРИАНТ 2: Центрирование с анимацией через opacity (рекомендуется для простоты) */
#client-detail-panel {
    max-width: 600px; /* Установите желаемую максимальную ширину */
    width: 100%; /* Убедитесь, что она занимает 100% доступной ширины до max-width */
    left: 0; /* Прикрепить к левому краю */
    right: 0; /* Прикрепить к правому краю */
    margin-left: auto; /* Центрировать по горизонтали */
    margin-right: auto; /* Центрировать по горизонтали */
    box-sizing: border-box; /* Важно для padding */
    padding-left: 15px; /* Возвращаем отступы для содержимого */
    padding-right: 15px; /* Возвращаем отступы для содержимого */

    /* Анимация через opacity вместо transform для центрированной панели */
    opacity: 0; /* Изначально скрыто */
    pointer-events: none; /* Не реагирует на события, когда скрыто */
    transition: opacity 0.3s ease-out; /* Плавное появление/исчезновение */
    transform: none !important; /* Убираем любые трансформации по умолчанию от .panel */

    /* Изначально скрываем панель, чтобы она не появлялась до анимации */
    display: none;

}
#client-detail-panel {
    padding-bottom: 90px;
}
#client-detail-panel.visible {
    opacity: 1; /* Показываем панель */
    pointer-events: auto; /* Реагирует на события, когда видно */
    display: flex; /* Переопределяем display: none из .panel, если нужно */
}

/* Также необходимо отключить анимации скольжения для этой панели,
   если вы используете вариант с opacity, чтобы они не конфликтовали. */
/* Новые keyframes для плавного появления и исчезновения */
@keyframes panelFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes panelFadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* * Вместо отключения анимации, мы назначаем кастомную.
 * Это позволяет событию 'animationend' сработать, и JS-логика продолжит выполняться корректно.
*/
#client-detail-panel.slide-in-right,
#client-detail-panel.slide-in-left {
    animation: panelFadeIn 0.3s forwards ease-out !important;
}

#client-detail-panel.slide-out-to-left,
#client-detail-panel.slide-out-to-right {
    animation: panelFadeOut 0.3s forwards ease-out !important;
}
/* === КОНЕЦ: ИСПРАВЛЕНИЕ АНИМАЦИИ === */

/* НОВЫЕ СТИЛИ ДЛЯ ВЫРАВНИВАНИЯ #clients-panel */
#clients-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
    /* Убрали общий padding, чтобы избежать двойных отступов */
    padding: 0;
    overflow-x: hidden; /* Скрываем горизонтальный скроллбар, если что-то выходит */
    overflow-y: auto; /* Позволяем вертикальный скроллбар для содержимого */
}

#clients-panel .panel-header,
#clients-panel .search-container {
    padding-left: 15px;
    padding-right: 15px;
    box-sizing: border-box; /* Убедимся, что padding учитывается в ширине */
    width: 100%; /* Убедитесь, что эти элементы занимают всю доступную ширину */
}
#clients-panel .search-container {
    margin-top: 10px;
}

#clients-panel .content-list {
    /* Применяем padding к самому списку */
    padding-left: 15px;
    padding-right: 15px;
    flex-grow: 1; /* Позволяет списку заполнять доступное пространство */
    overflow-y: auto; /* Если список очень длинный, он будет прокручиваться сам */
    -ms-overflow-style: none; /* Скрывает скроллбар для IE/Edge */
    scrollbar-width: none; /* Скрывает скроллбар для Firefox */
    width: 100%; /* Убедитесь, что список занимает всю доступную ширину родителя с учетом padding */
    box-sizing: border-box; /* Убедимся, что padding учитывается в ширине списка */
}
#clients-panel .content-list::-webkit-scrollbar { display: none; }

/* Убедимся, что карточки внутри content-list всегда 100% ширины относительно родителя с padding */
.content-list .card {
    width: 100%;
    box-sizing: border-box; /* Повторяем на всякий случай, это критично */
    max-width: 100%;
}
/*
 * **** НОВЫЕ СТИЛИ ДЛЯ КНОПОК ВЫБОРА МЕДИА ****
 */
.media-buttons-container {
    display: flex;
    gap: 12px;
    width: 100%;
}

.button-secondary-media {
    flex: 1; /* Кнопки занимают равное пространство */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    font-size: 15px;
    font-weight: 500;
    background-color: var(--tg-bg-color);
    color: var(--tg-link-color);
    border: 1px solid var(--form-field-border-color);
    border-radius: var(--radius-m);
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s, transform 0.1s ease;
}

.button-secondary-media:hover {
    border-color: var(--tg-link-color);
    background-color: var(--tg-link-color);
    color: var(--tg-button-text-color);
}

.button-secondary-media:active {
    transform: scale(0.97);
}


/*
 * ===================================================================
 * СТИЛИ ДЛЯ НОВОЙ ПОЛНОЭКРАННОЙ ГАЛЕРЕИ (SWIPER)
 * ===================================================================
 */

/* Затемненный фон */
.fullscreen-media-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    /* Для плавного закрытия по свайпу */
    transition: background-color 0.3s ease-out;
}

/* Контейнер Swiper внутри оверлея */
#fullscreen-swiper {
    width: 100%;
    height: 100%;
    /* Для плавного возврата на место после неудачного свайпа */
    transition: transform 0.3s ease-out;
}

/* Слайд в полноэкранном режиме */
#fullscreen-swiper .swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Важно для корректной работы zoom */
}

/* Контейнер для увеличения (pinch-to-zoom) */
#fullscreen-swiper .swiper-zoom-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

#fullscreen-swiper .swiper-zoom-container img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Изображение полностью видно */
}

/* Пагинация (счетчик "3 / 10") */
.fullscreen-pagination {
    bottom: 20px !important;
    color: #fff;
    font-size: 16px;
    font-weight: 500;
    background-color: rgba(0,0,0,0.3);
    padding: 5px 12px;
    border-radius: 15px;
    /* Делаем пагинацию неширокой, чтобы она была по центру */
    width: auto !important;
    left: 50% !important;
    transform: translateX(-50%);
}

/* Класс для анимации закрытия свайпом */
.fullscreen-media-overlay.is-closing {
    background-color: transparent !important;
}
/*
 * ===================================================================
 * ИСПРАВЛЕНИЕ ВИДИМОСТИ КНОПОК И УЛУЧШЕНИЕ ИХ СТИЛЯ (НОВЫЙ БЛОК)
 * ===================================================================
 */

/*
 * ШАГ 1: Добавление новых стилей для цветных кнопок
 * * Кнопка для опасных действий (удаление, блокировка).
 * Используйте <button class="button-danger">...</button>
 */
.button-danger {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--button-danger-color);
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-danger:hover {
    filter: brightness(1.1);
}
.button-danger:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/*
 * Кнопка для действий, требующих внимания (установка стоимости, подтверждение).
 * Используйте <button class="button-warning">...</button>
 */
.button-warning {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-m);
    background-color: var(--status-progress); /* Оранжевый цвет */
    color: var(--tg-button-text-color);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.1s ease;
    box-shadow: var(--shadow-soft);
}
.button-warning:hover {
    filter: brightness(1.1);
}
.button-warning:active {
    transform: scale(0.98);
    filter: brightness(0.95);
}

/*
 * ШАГ 2: Изменение структуры панелей для "липкого" футера
 *
 * Панели с деталями теперь являются flex-контейнерами, которые не прокручиваются.
 * Прокручивается только их внутренний контент.
 */
#order-detail-panel {
    padding-bottom: 90px; /* Убираем padding-bottom у самой панели */
    /* overflow: hidden; */ /* Предотвращаем двойной скроллбар */
}


/*
 * Новый класс для обертки прокручиваемого контента.
 * Этот блок должен быть добавлен в HTML-разметку.
 */
.panel-scrollable-content {
    flex-grow: 1; /* Занимает всё доступное пространство по высоте */
    overflow-y: auto; /* Включает вертикальную прокрутку */
    padding: 0 15px; /* Боковые отступы для контента */
    padding-top: 5px;
}

/*
 * ШАГ 3: Стилизация футера с кнопками действий
 *
 * Блоки .order-detail-actions и .client-actions теперь являются "липкими" футерами.
 */
.order-detail-actions,
.client-actions {
    flex-shrink: 0; /* Запрещаем блоку сжиматься */
    display: flex;
    flex-wrap: wrap; /* Позволяем кнопкам переноситься на новую строку */
    gap: 12px; /* Расстояние между кнопками */
    padding: 15px;
    padding-bottom: calc(15px + env(safe-area-inset-bottom)); /* Безопасная зона на iPhone */
    background: linear-gradient(to top, var(--tg-bg-color) 75%, transparent); /* Градиент для плавности */
    margin: 0; /* Сбрасываем внешние отступы */
    z-index: 10;
    border-top: 1px solid var(--fieldset-border-color); /* Небольшая линия-разделитель */
}

/* Кнопки внутри футера */
.order-detail-actions button,
.client-actions button {
    flex: 1 1 160px; /* Кнопки растягиваются, но не становятся меньше 160px */
    margin: 0;
}