# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤–Ω–∏–∑—É, –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ 403 –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API:

```
2025/07/21 21:35:28 "GET /api/admin/orders?status=active HTTP/1.1" - 403 36B
2025/07/21 21:35:30 "GET /api/admin/orders?status=new HTTP/1.1" - 403 36B
```

## üîç –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoint'—ã**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—ã—Ç–∞–ª–∏—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `/api/admin/orders` –≤–º–µ—Å—Ç–æ `/api/user/orders`
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π**: –í –∫–æ–¥–µ –±—ã–ª–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∫ `null` –∑–Ω–∞—á–µ–Ω–∏—è–º –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**: –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö API –≤—ã–∑–æ–≤–∞—Ö –Ω–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã API endpoint'—ã –≤ –Ω–æ–≤–æ–º –º–æ–¥—É–ª—å–Ω–æ–º –∫–æ–¥–µ

**–§–∞–π–ª**: `webapp/js/modules/api.js`

–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –≤—ã–±–æ—Ä–∞ endpoint'–æ–≤:

```javascript
async fetchOrders(statusKey = 'active') {
    const userRole = this.app.state.user?.Role;
    
    // Choose correct endpoint based on user role
    if (userRole === 'user') {
        return this.fetch(`/api/user/orders?status=${statusKey}`);
    } else {
        return this.fetch(`/api/admin/orders?status=${statusKey}`);
    }
}

async fetchOrderDetails(orderId) {
    const userRole = this.app.state.user?.Role;
    
    // Choose correct endpoint based on user role
    if (userRole === 'user') {
        return this.fetch(`/api/user/order/${orderId}`);
    } else {
        return this.fetch(`/api/admin/order/${orderId}`);
    }
}
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–§–∞–π–ª**: `webapp/js/modules/ui.js`

–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:

```javascript
async handleNavigationClick(navId) {
    const userRole = this.app.state.user?.Role;
    const api = this.app.modules.get('api');
    
    switch(navId) {
        case 'orders':
            await this.handleOrdersNavigation(userRole, api);
            break;
        case 'clients':
            await this.handleClientsNavigation(api);
            break;
        // ... –¥—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏
    }
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π –≤ legacy –∫–æ–¥–µ

**–§–∞–π–ª**: `webapp/app.js`

```javascript
// –ë—ã–ª–æ:
if (App.state.user.Role === 'user')

// –°—Ç–∞–ª–æ:
if (App.state.user?.Role === 'user')
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `showError()` –≤ UIModule –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (role: 'user')** —Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º endpoint'–∞–º:
   - `/api/user/orders` –≤–º–µ—Å—Ç–æ `/api/admin/orders`
   - `/api/user/order/{id}` –≤–º–µ—Å—Ç–æ `/api/admin/order/{id}`

2. **–í–ª–∞–¥–µ–ª—å—Ü—ã (role: 'owner')** –ø–æ–ª—É—á–∞—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º:
   - `/api/admin/orders` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–ö–ª–∏–µ–Ω—Ç—ã, –®—Ç–∞—Ç, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞)

3. **–ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏** –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º:

- **user**: [üìã –ó–∞–∫–∞–∑—ã] [‚ûï –°–æ–∑–¥–∞—Ç—å] [üí¨ –°–≤—è–∑–∞—Ç—å—Å—è]
- **operator**: [üìã –ó–∞–∫–∞–∑—ã] [üë• –ö–ª–∏–µ–Ω—Ç—ã] [‚ûï –°–æ–∑–¥–∞—Ç—å]  
- **main_operator**: [üìã –ó–∞–∫–∞–∑—ã] [üë• –ö–ª–∏–µ–Ω—Ç—ã] [üè¢ –ü–µ—Ä—Å–æ–Ω–∞–ª] [‚ûï –°–æ–∑–¥–∞—Ç—å]
- **owner**: [üìã –ó–∞–∫–∞–∑—ã] [üë• –ö–ª–∏–µ–Ω—Ç—ã] [üè¢ –ü–µ—Ä—Å–æ–Ω–∞–ª] [üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞] [‚ûï –°–æ–∑–¥–∞—Ç—å]
- **driver**: [üöõ –ó–∞–∫–∞–∑—ã] [üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–Ω–∏–∑—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 403 –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –æ–±–µ–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏: –Ω–æ–≤–æ–π –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ legacy –∫–æ–¥–æ–º
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç `null` –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–æ–ª–µ–π
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ 